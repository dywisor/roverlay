<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9: http://docutils.sourceforge.net/" />
<title>Automatically Generated Overlay of R packages</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#introduction" id="id4">1&nbsp;&nbsp;&nbsp;Introduction</a></li>
<li><a class="reference internal" href="#installation" id="id5">2&nbsp;&nbsp;&nbsp;Installation</a><ul class="auto-toc">
<li><a class="reference internal" href="#prerequisites" id="id6">2.1&nbsp;&nbsp;&nbsp;Prerequisites</a></li>
<li><a class="reference internal" href="#via-emerge-gentoo" id="id7">2.2&nbsp;&nbsp;&nbsp;via emerge (Gentoo)</a></li>
<li><a class="reference internal" href="#manual-installation" id="id8">2.3&nbsp;&nbsp;&nbsp;Manual Installation</a></li>
<li><a class="reference internal" href="#using-roverlay-without-installation" id="id9">2.4&nbsp;&nbsp;&nbsp;Using <em>roverlay</em> without installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-roverlay" id="id10">3&nbsp;&nbsp;&nbsp;Running Roverlay</a><ul class="auto-toc">
<li><a class="reference internal" href="#required-configuration-steps" id="id11">3.1&nbsp;&nbsp;&nbsp;Required configuration steps</a><ul class="auto-toc">
<li><a class="reference internal" href="#extended-configuration-where-to-go-from-here" id="id12">3.1.1&nbsp;&nbsp;&nbsp;Extended Configuration / Where to go from here?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-it" id="id13">3.2&nbsp;&nbsp;&nbsp;Running it</a></li>
<li><a class="reference internal" href="#providing-a-package-mirror" id="id14">3.3&nbsp;&nbsp;&nbsp;Providing a package mirror</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-implementation-overview" id="id15">4&nbsp;&nbsp;&nbsp;Basic Implementation Overview</a><ul class="auto-toc">
<li><a class="reference internal" href="#how-roverlay-works" id="id16">4.1&nbsp;&nbsp;&nbsp;How <em>roverlay</em> works</a></li>
<li><a class="reference internal" href="#expected-overlay-result-structure-of-the-generated-overlay" id="id17">4.2&nbsp;&nbsp;&nbsp;Expected Overlay Result / Structure of the generated overlay</a><ul class="auto-toc">
<li><a class="reference internal" href="#expected-ebuild-result" id="id18">4.2.1&nbsp;&nbsp;&nbsp;Expected Ebuild Result</a></li>
<li><a class="reference internal" href="#expected-metadata-xml-result" id="id19">4.2.2&nbsp;&nbsp;&nbsp;Expected <em>metadata.xml</em> Result</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#repositories-getting-packages" id="id20">5&nbsp;&nbsp;&nbsp;Repositories / Getting Packages</a><ul class="auto-toc">
<li><a class="reference internal" href="#a-word-about-repo-config-files" id="id21">5.1&nbsp;&nbsp;&nbsp;A word about repo config files</a></li>
<li><a class="reference internal" href="#rsync-repos" id="id22">5.2&nbsp;&nbsp;&nbsp;Rsync repos</a></li>
<li><a class="reference internal" href="#getting-packages-from-a-repository-that-supports-http-only" id="id23">5.3&nbsp;&nbsp;&nbsp;Getting packages from a repository that supports http only</a></li>
<li><a class="reference internal" href="#getting-packages-from-several-remotes-using-http-and-a-package-list" id="id24">5.4&nbsp;&nbsp;&nbsp;Getting packages from several remotes using http and a package list</a></li>
<li><a class="reference internal" href="#using-local-directories" id="id25">5.5&nbsp;&nbsp;&nbsp;Using local directories</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dependency-rules" id="id26">6&nbsp;&nbsp;&nbsp;Dependency Rules</a><ul class="auto-toc">
<li><a class="reference internal" href="#simple-dependency-rules" id="id27">6.1&nbsp;&nbsp;&nbsp;Simple Dependency Rules</a><ul class="auto-toc">
<li><a class="reference internal" href="#rule-variants" id="id28">6.1.1&nbsp;&nbsp;&nbsp;Rule Variants</a></li>
<li><a class="reference internal" href="#rule-types" id="id29">6.1.2&nbsp;&nbsp;&nbsp;Rule types</a></li>
<li><a class="reference internal" href="#rule-file-examples" id="id30">6.1.3&nbsp;&nbsp;&nbsp;Rule File Examples</a></li>
<li><a class="reference internal" href="#rule-file-syntax" id="id31">6.1.4&nbsp;&nbsp;&nbsp;Rule File Syntax</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-reference" id="id32">7&nbsp;&nbsp;&nbsp;Configuration Reference</a><ul class="auto-toc">
<li><a class="reference internal" href="#misc-options" id="id33">7.1&nbsp;&nbsp;&nbsp;misc options</a></li>
<li><a class="reference internal" href="#overlay-options" id="id34">7.2&nbsp;&nbsp;&nbsp;overlay options</a></li>
<li><a class="reference internal" href="#other-config-files" id="id35">7.3&nbsp;&nbsp;&nbsp;other config files</a></li>
<li><a class="reference internal" href="#logging" id="id36">7.4&nbsp;&nbsp;&nbsp;logging</a><ul class="auto-toc">
<li><a class="reference internal" href="#console-logging" id="id37">7.4.1&nbsp;&nbsp;&nbsp;console logging</a></li>
<li><a class="reference internal" href="#file-logging" id="id38">7.4.2&nbsp;&nbsp;&nbsp;file logging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#options-for-debugging-manual-dependency-rule-creation-and-testing" id="id39">7.5&nbsp;&nbsp;&nbsp;options for debugging, manual dependency rule creation and testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#field-definition-config" id="id40">8&nbsp;&nbsp;&nbsp;Field Definition Config</a><ul class="auto-toc">
<li><a class="reference internal" href="#example-the-default-field-definition-file" id="id41">8.1&nbsp;&nbsp;&nbsp;Example: The default field definition file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dependency-resolution-console" id="id42">9&nbsp;&nbsp;&nbsp;Dependency Resolution Console</a></li>
<li><a class="reference internal" href="#implementation-overview" id="id43">10&nbsp;&nbsp;&nbsp;Implementation Overview</a><ul class="auto-toc">
<li><a class="reference internal" href="#packageinfo" id="id44">10.1&nbsp;&nbsp;&nbsp;PackageInfo</a></li>
<li><a class="reference internal" href="#repository-management" id="id45">10.2&nbsp;&nbsp;&nbsp;Repository Management</a><ul class="auto-toc">
<li><a class="reference internal" href="#id3" id="id46">10.2.1&nbsp;&nbsp;&nbsp;Repositories</a><ul class="auto-toc">
<li><a class="reference internal" href="#adding-new-repository-types" id="id47">10.2.1.1&nbsp;&nbsp;&nbsp;Adding new repository types</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#overlay" id="id48">10.3&nbsp;&nbsp;&nbsp;Overlay</a><ul class="auto-toc">
<li><a class="reference internal" href="#metadata-creation" id="id49">10.3.1&nbsp;&nbsp;&nbsp;Metadata Creation</a></li>
<li><a class="reference internal" href="#manifest-creation" id="id50">10.3.2&nbsp;&nbsp;&nbsp;Manifest Creation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ebuild-creation" id="id51">10.4&nbsp;&nbsp;&nbsp;Ebuild Creation</a><ul class="auto-toc">
<li><a class="reference internal" href="#ebuild-variables" id="id52">10.4.1&nbsp;&nbsp;&nbsp;Ebuild Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overlay-creation" id="id53">10.5&nbsp;&nbsp;&nbsp;Overlay Creation</a></li>
<li><a class="reference internal" href="#dependency-resolution" id="id54">10.6&nbsp;&nbsp;&nbsp;Dependency Resolution</a><ul class="auto-toc">
<li><a class="reference internal" href="#dependency-types" id="id55">10.6.1&nbsp;&nbsp;&nbsp;Dependency types</a><ul class="auto-toc">
<li><a class="reference internal" href="#description-file-dependency-fields" id="id56">10.6.1.1&nbsp;&nbsp;&nbsp;DESCRIPTION file dependency fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dependency-environments" id="id57">10.6.2&nbsp;&nbsp;&nbsp;Dependency Environments</a></li>
<li><a class="reference internal" href="#ebuildjob-channel" id="id58">10.6.3&nbsp;&nbsp;&nbsp;EbuildJob Channel</a></li>
<li><a class="reference internal" href="#dependency-rule-pools" id="id59">10.6.4&nbsp;&nbsp;&nbsp;Dependency Rule Pools</a></li>
<li><a class="reference internal" href="#dependency-resolver-modules" id="id60">10.6.5&nbsp;&nbsp;&nbsp;Dependency Resolver Modules</a></li>
<li><a class="reference internal" href="#dependency-resolver" id="id61">10.6.6&nbsp;&nbsp;&nbsp;Dependency Resolver</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#contents">1&nbsp;&nbsp;&nbsp;Introduction</a></h1>
<p><em>roverlay</em> is an application that aims to provide integration of R packages
in Gentoo by creating a portage overlay for them.
Naturally, this also requires proper dependency resolution, especially on the
system level which cannot be done by <em>install.packages()</em> in R.</p>
<p>The project associated with <em>roverlay</em> is called
<em>Automatically generated overlay of R packages</em>, the initial work has been
done during the <em>Google Summer of Code 2012</em>.</p>
<p>At its current state, <em>roverlay</em> is capable of creating a complete overlay
with metadata and Manifest files by reading R packages.
It is also able to work incrementally, i.e. update an existing <em>R Overlay</em>.
Most aspects of overlay creation are configurable with text files.</p>
<p><em>roverlay</em> is written in python. A homepage is not available, only a
<a class="reference external" href="http://git.overlays.gentoo.org/gitweb/?p=proj/R_overlay.git;a=summary">git repository</a> that contains the source code.</p>
<p>This document is targeted at</p>
<blockquote>
<ul>
<li><p class="first">overlay maintainers who <strong>use roverlay</strong> to create the R Overlay</p>
<p>The most relevant chapters are <a class="reference internal" href="#installation">Installation</a> (2) and
<a class="reference internal" href="#running-roverlay">Running Roverlay</a> (3). Additionally, have a look at
<a class="reference internal" href="#basic-implementation-overview">Basic Implementation Overview</a> (4) if you want to know what <em>roverlay</em>
does and what to expect from the generated overlay.</p>
</li>
<li><p class="first"><em>roverlay</em> maintainers who <strong>control and test overlay creation</strong>,
e.g. configure which R packages will be part of the generated overlay</p>
<p>Depending on what you want to configure, chapters 5-8 are relevant,
namely <a class="reference internal" href="#repositories-getting-packages">Repositories / Getting Packages</a>, <a class="reference internal" href="#dependency-rules">Dependency Rules</a>,
<a class="reference internal" href="#configuration-reference">Configuration Reference</a> and <a class="reference internal" href="#field-definition-config">Field Definition Config</a>.</p>
<p>There is another chapter that is only interesting for testing, the
<a class="reference internal" href="#dependency-resolution-console">Dependency Resolution Console</a> (9), which can be used to interactively
test dependency rules.</p>
</li>
<li><p class="first"><em>roverlay</em> code maintainers who want to know <strong>how roverlay works</strong> for
code improvements etc.</p>
<p>The most important chapter is <a class="reference internal" href="#implementation-overview">Implementation Overview</a> (10) which has
references to other chapters (4-8) where required.</p>
</li>
</ul>
</blockquote>
<p>Expected prior knowlegde:</p>
<blockquote>
<ul class="simple">
<li>a few <em>R package</em> basics</li>
<li>portage basics, e.g. <em>Depend Atoms</em> and what an overlay is</li>
</ul>
</blockquote>
</div>
<div class="section" id="installation">
<h1><a class="toc-backref" href="#contents">2&nbsp;&nbsp;&nbsp;Installation</a></h1>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#contents">2.1&nbsp;&nbsp;&nbsp;Prerequisites</a></h2>
<ul>
<li><p class="first">python &gt;= 2.7 (tested with python 2.7 and 3.2)</p>
</li>
<li><p class="first">argparse (<a class="reference external" href="http://code.google.com/p/argparse">http://code.google.com/p/argparse</a>)</p>
</li>
<li><p class="first">rsync (for using rsync repositories)</p>
</li>
<li><p class="first">for Manifest creation:</p>
<ul class="simple">
<li><em>ebuild</em> from portage</li>
<li><em>true</em> or <em>echo</em> from coreutils or busybox for preventing
package downloads during Manifest creation (optional)</li>
</ul>
</li>
<li><p class="first">for generating documentation files: python docutils &gt;= 0.9</p>
</li>
<li><p class="first">hardware requirements (when using the default configuration):</p>
<blockquote>
<dl class="docutils">
<dt>disk</dt>
<dd><ul class="first last simple">
<li>50-55GB disk space for the R packages</li>
<li>a filesystem that supports symbolic links</li>
<li>there will be many small-sized files (ebuilds),
so a filesystem with lots of inodes and a small block size
may be advantageous</li>
</ul>
</dd>
<dt>memory</dt>
<dd><p class="first last">up to 600MB which depends on the amount of processed packages and the
write mechanism in use. The amount can be halved (approximately) when
using a slower one.</p>
</dd>
<dt>time</dt>
<dd><p class="first last">Expect 3-6h execution time, depending on computing and I/O speed.</p>
</dd>
</dl>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="via-emerge-gentoo">
<h2><a class="toc-backref" href="#contents">2.2&nbsp;&nbsp;&nbsp;via emerge (Gentoo)</a></h2>
<p>A live ebuild is available, <a class="reference external" href="http://git.overlays.gentoo.org/gitweb/?p=proj/R_overlay.git;a=blob;f=roverlay-9999.ebuild;hb=refs/heads/master">roverlay-9999.ebuild</a>.
Add it to your local overlay and run <tt class="docutils literal">emerge roverlay</tt>, which also installs
all necessary config files into <em>/etc/roverlay</em>.</p>
</div>
<div class="section" id="manual-installation">
<h2><a class="toc-backref" href="#contents">2.3&nbsp;&nbsp;&nbsp;Manual Installation</a></h2>
<p>After installing the dependencies as listed in <a class="reference internal" href="#prerequisites">Prerequisites</a>, clone the
<a class="reference external" href="http://git.overlays.gentoo.org/gitweb/?p=proj/R_overlay.git;a=summary">roverlay git repo</a> and then install <em>roverlay</em> and its python modules:</p>
<pre class="code sh literal-block">
git clone git://git.overlays.gentoo.org/proj/R_overlay.git

<span class="nb">cd </span>R_overlay <span class="o">&amp;&amp;</span> make install
</pre>
<p><tt class="docutils literal">make install</tt> also accepts some variables, namely:</p>
<ul class="simple">
<li><em>DESTDIR</em></li>
<li><em>BINDIR</em>, defaults to <em>DESTDIR</em>/usr/local/bin</li>
<li><em>PYMOD_FILE_LIST</em>, which lists the installed python module files
and defaults to './roverlay_files.list'</li>
<li><em>PYTHON</em>, name or path of the python interpreter that is used to run
'setup.py', defaults to 'python'</li>
</ul>
<p><em>roverlay</em> can later be uninstalled with <tt class="docutils literal">make uninstall</tt>.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure to include <tt class="docutils literal"><span class="pre">--record</span> <span class="pre">&lt;somewhere&gt;/roverlay_files.list</span></tt>
when running <tt class="docutils literal">./setup.py install</tt> manually,
which can later be used to safely remove the python module files with
<tt class="docutils literal">xargs rm <span class="pre">-vrf</span> &lt; <span class="pre">&lt;somewhere&gt;/roverlay_files.list</span></tt>.
The <em>make</em> targets take care of this.</p>
</div>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p class="last">Support for this installation type is limited - no config files will be
installed!</p>
</div>
</div>
<div class="section" id="using-roverlay-without-installation">
<h2><a class="toc-backref" href="#contents">2.4&nbsp;&nbsp;&nbsp;Using <em>roverlay</em> without installation</a></h2>
<p>This is possible, too.
Make sure to meet the dependencies as listed in <a class="reference internal" href="#prerequisites">Prerequisites</a>.
Then, simply clone the git repository to a local directory that is referenced
as the <em>R Overlay src directory</em> from now on.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p>You have to <em>cd</em> into the <em>R Overlay src directory</em> before running
<em>roverlay</em> to ensure that the python modules can be imported correctly.</p>
<p>You can work around this by setting up a wrapper script:</p>
<pre class="code sh last literal-block">
<span class="c">#!/bin/sh
# /usr/local/bin/roverlay.sh
# example wrapper script for roverlay
</span><span class="nb">cd</span> <span class="k">${</span><span class="nv">ROVERLAY_SRC</span><span class="k">:-</span><span class="p">~/roverlay/src</span><span class="k">}</span> <span class="o">&amp;&amp;</span> ./roverlay.py <span class="nv">$*</span>
</pre>
</div>
</div>
</div>
<div class="section" id="running-roverlay">
<h1><a class="toc-backref" href="#contents">3&nbsp;&nbsp;&nbsp;Running Roverlay</a></h1>
<div class="section" id="required-configuration-steps">
<h2><a class="toc-backref" href="#contents">3.1&nbsp;&nbsp;&nbsp;Required configuration steps</a></h2>
<p><em>roverlay</em> needs a configuration file to run.
If roverlay has been installed with <em>emerge</em>, it will for the config file in
that order:</p>
<ol class="arabic simple">
<li><em>&lt;current directory&gt;/R-overlay.conf</em></li>
<li><em>~/.R-overlay.conf</em></li>
<li><em>/etc/roverlay/R-overlay.conf</em>,
which is part of the installation but has to be modified.</li>
</ol>
<p>Otherwise, <em>roverlay</em> will only look for <em>R-overlay.conf</em> in the current
directory. An example config file is available in the
<em>R Overlay src directory</em>.</p>
<p>The config file is a text file with '&lt;option&gt; = &lt;value&gt;' syntax. Some options
accept multiple values (e.g. &lt;option&gt; = file1, file2), in which case the
values have to be enclosed with quotes (-&gt; <tt class="docutils literal">&lt;option&gt; = &quot;file1 file2&quot;</tt>).</p>
<p>The following options should be set before running <em>roverlay</em>:</p>
<blockquote>
<dl class="docutils">
<dt>OVERLAY_DIR</dt>
<dd><p class="first">This sets the directory of the overlay that will be created.
This option is <strong>required</strong> and can be overridden on the command line
via <tt class="docutils literal"><span class="pre">--overlay</span> &lt;directory&gt;</tt>.</p>
<p class="last">Example: OVERLAY_DIR = ~/roverlay/overlay</p>
</dd>
<dt>DISTFILES</dt>
<dd><p class="first">This sets the root directory of all per-repo package directories.
This option is <strong>required</strong> and can be overridden on the command line
via <tt class="docutils literal"><span class="pre">--distroot</span> &lt;directory&gt;</tt>.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">This directory will also contain a directory <em>__tmp__</em>
with symlinks to all packages which can be used as package mirror,
see <a class="reference internal" href="#providing-a-package-mirror">Providing a package mirror</a>.</p>
</div>
<p class="last">Example: DISTFILES = ~/roverlay/distfiles</p>
</dd>
<dt>LOG_FILE</dt>
<dd><p class="first">This sets the log file. An empty value disables file logging.</p>
<p class="last">Example: LOG_FILE = ~/roverlay/log/roverlay.log</p>
</dd>
<dt>LOG_LEVEL</dt>
<dd><p class="first">This sets the global log level, which is used for all log formats
without an own log level. Valid log levels are <tt class="docutils literal">DEBUG</tt>, <tt class="docutils literal">INFO</tt>,
<tt class="docutils literal">WARN</tt>/<tt class="docutils literal">WARNING</tt>, <tt class="docutils literal">ERROR</tt> and <tt class="docutils literal">CRITICAL</tt>.</p>
<p>Example: LOG_LEVEL = WARNING</p>
<div class="note last">
<p class="first admonition-title">Note</p>
<p class="last">Be careful with low log levels, especially <em>DEBUG</em>.
They produce a lot of messages that help to track ebuild creation of
the R packages, but increase the size of log files dramatically.</p>
</div>
</dd>
<dt>LOG_LEVEL_CONSOLE</dt>
<dd><p class="first">This sets the console log level.</p>
<p class="last">Example: LOG_LEVEL_CONSOLE = INFO</p>
</dd>
<dt>LOG_LEVEL_FILE</dt>
<dd><p class="first">This sets the log level for file logging.</p>
<p class="last">Example: LOG_LEVEL_FILE = ERROR</p>
</dd>
</dl>
</blockquote>
<p>The following options should also be set (most of them are required), but
have reasonable defaults if <em>roverlay</em> has been installed using <em>emerge</em>:</p>
<blockquote>
<dl class="docutils">
<dt>SIMPLE_RULES_FILE</dt>
<dd><p class="first">This option lists dependency rule files and/or directories with
such files that should be used for dependency resolution.
Although not required, this option is <strong>recommended</strong> since ebuild
creation without dependency rules fails for most R packages.</p>
<p class="last">Example: SIMPLE_RULES_FILE = ~/roverlay/config/simple-deprules.d</p>
</dd>
<dt>REPO_CONFIG</dt>
<dd><p class="first">A list with one or more files that list repositories.
This option is <strong>required</strong> and can be overridden on the command line
via one or more <tt class="docutils literal"><span class="pre">repo-config</span> &lt;file&gt;</tt> statements.</p>
<p class="last">Example: REPO_CONFIG = ~/roverlay/config/repo.list</p>
</dd>
<dt>FIELD_DEFINITION</dt>
<dd><p class="first">The value of this option should point to a field definition file which
controls how an R package's DESCRIPTION file is read.
The file supplied by default should be fine.
This option is <strong>required</strong> and can be overridden on the command line
via <tt class="docutils literal"><span class="pre">--field-definition</span> &lt;file&gt;</tt>.</p>
<p class="last">Example: FIELD_DEFINITION = ~/roverlay/config/description_fields.conf</p>
</dd>
<dt>OVERLAY_ECLASS</dt>
<dd><p class="first">This option lists eclass files that should be imported into the overlay
(into <em>OVERLAY_DIR</em>/eclass/) and inherited in all ebuilds.
Specifying an eclass file that implements the ebuild phase functions
(e.g. <em>src_install()</em>) is highly <strong>recommended</strong>. A default file
named <em>R-packages.eclass</em> should be part of your installation.</p>
<p class="last">Example: OVERLAY_ECLASS = ~/roverlay/eclass/R-packages.eclass</p>
</dd>
</dl>
</blockquote>
<p>There is another option that is useful for creating new dependency rules,
<a class="reference internal" href="#log-file-unresolvable">LOG_FILE_UNRESOLVABLE</a>, which will write all unresolvable dependencies
to the specified file (one dependency string per line).</p>
<div class="section" id="extended-configuration-where-to-go-from-here">
<h3><a class="toc-backref" href="#contents">3.1.1&nbsp;&nbsp;&nbsp;Extended Configuration / Where to go from here?</a></h3>
<p>Proceed with <a class="reference internal" href="#running-it">Running it</a> if the default configuration and the changes already
made are fine, otherwise the following chapters are relevant and should
provide you with the knowledge to determine the ideal configuration.</p>
<dl class="docutils">
<dt>Repositories</dt>
<dd>See <a class="reference internal" href="#repositories-getting-packages">Repositories / Getting Packages</a>, which describes how repositories
can be configured.</dd>
<dt>Dependency Rules</dt>
<dd>See <a class="reference internal" href="#dependency-rules">Dependency Rules</a>, which explains the dependency rule syntax amd how
they work.</dd>
<dt>Main Config</dt>
<dd>See <a class="reference internal" href="#configuration-reference">Configuration Reference</a> for all main config options like log file
rotation and assistance for writing new <em>dependency rules</em>.</dd>
<dt>Field Definition</dt>
<dd>Refer to <a class="reference internal" href="#id2">Field Definition</a> in case you want to change <em>how</em> R packages
are being read, e.g. if you want the 'Depents' information field (obviously
a typo) to be understood as 'Depends'.</dd>
</dl>
</div>
</div>
<div class="section" id="running-it">
<h2><a class="toc-backref" href="#contents">3.2&nbsp;&nbsp;&nbsp;Running it</a></h2>
<p>If <em>roverlay</em> has been installed, you can run it with <tt class="docutils literal">roverlay</tt>, otherwise
cd into the <em>R overlay src directory</em> and run <tt class="docutils literal">./roverlay.py</tt>.</p>
<p>In any case, the basic <em>roverlay</em> script usage is</p>
<pre class="code literal-block">
roverlay --config &lt;config file&gt; [&lt;options&gt;] [&lt;commands&gt;]
</pre>
<p>or</p>
<pre class="code literal-block">
roverlay [&lt;options&gt;] [&lt;commands&gt;]
</pre>
<p>which will search for the config file as described in
<a class="reference internal" href="#required-configuration-steps">Required configuration steps</a>. The default command is <em>create</em>, which
downloads the R packages (unless explicitly forbidden to do so) and generates
the overlay. This is the desired behavior in most cases, so simply running
<tt class="docutils literal">roverlay</tt> should be fine. See <a class="reference internal" href="#basic-implementation-overview">Basic Implementation Overview</a> if you want
to know in detail what <em>roverlay</em> does before running it.</p>
<p><em>roverlay</em> also accepts some <strong>options</strong>, most notably:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--nosync</span>, <span class="option">--no-sync</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Disable downloading of R packages.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--no-incremental</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Force recreation of existing ebuilds</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--immediate-ebuild-writes</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Immediately write ebuilds when they are ready.</p>
<p>The default behavior is to wait for all ebuilds and then write them using
ebuild write threads. The latter one is faster, but consumes more memory
since ebuilds must be kept until all packages have been processed.
Test results show that memory consumption increases by factor 2 when using
the faster write mechanism (at ca. 95% ebuild creation success rate),
&lt;&lt;while ebuild write time decreases by ???&gt;&gt;.</p>
<p class="last">Summary: Expect 300 (slow) or 600MB (fast) memory consumption when using
the default package repositories.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--config <var>file</var></span>, <span class="option">-c <var>file</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Path to the config file</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--help</span>, <span class="option">-h</span></kbd></td>
<td>Show all options</td></tr>
</tbody>
</table>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last"><em>--no-incremental</em> does not delete an existing overlay, it merely ignores
and, potentially, overwrites existing ebuilds.
Use <em>rm -rf &lt;overlay&gt;</em> to do that.</p>
</div>
<p>For <strong>testing</strong> <em>roverlay</em>, these <strong>options</strong> may be convenient:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--no-manifest</span></kbd></td>
<td><p class="first">Skip Manifest file creation.</p>
<p class="last">This saves a considerable amount of time
(&gt;100min when using the default package repositories) at the expense of
an overlay that is not suitable for production usage.</p>
</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--no-write</span></kbd></td>
<td>Disable overlay writing</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--show</span></kbd></td>
<td>Print all ebuilds and metadata to console</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--repo-config <var>file</var></span>, <span class="option">-R <var>file</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Repo config file to use. Can be specified more than once.
This disables all repo files configured in the main config file.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--distdir <var>directory</var></span>, <span class="option">--from <var>directory</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Create an overlay using the packages found in <em>directory</em>. This disables
all other repositories. The <em>SRC_URI</em> ebuild variable will be invalid!</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--overlay <var>directory</var></span>, <span class="option">-O <var>directory</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Create the overlay at the given position.</td></tr>
</tbody>
</table>
<p>For reference, these <strong>commands</strong> are accepted by <em>roverlay</em>:</p>
<dl class="docutils">
<dt>create</dt>
<dd>As described above, this will run ebuild, metadata creation, including
overlay and Manifest file writing.
This command implies the <strong>sync</strong> command unless the <em>--nosync</em> option
is specified.</dd>
<dt>sync</dt>
<dd>This will download all packages from the configured remotes.</dd>
<dt>depres_console, depres</dt>
<dd><p class="first">Starts an interactive dependency resolution console that supports rule
creation/deletion, loading rules from files, writing rules to files
and resolving dependencies.</p>
<p>Meant for <strong>testing only</strong>.</p>
<p class="last">More information can be found in the <a class="reference internal" href="#depres-console">DepRes Console</a> section.</p>
</dd>
</dl>
</div>
<div class="section" id="providing-a-package-mirror">
<h2><a class="toc-backref" href="#contents">3.3&nbsp;&nbsp;&nbsp;Providing a package mirror</a></h2>
<p>No recommendations available at this time.
The current ManifestCreation implementation creates a directory
<em>&lt;distfiles root&gt;/__tmp__</em> with symlinks to all packages, which could be used
for providing packages, but this may change in near future since external
Manifest creation is too slow (takes &gt;60% of overlay creation time).</p>
</div>
</div>
<div class="section" id="basic-implementation-overview">
<h1><a class="toc-backref" href="#contents">4&nbsp;&nbsp;&nbsp;Basic Implementation Overview</a></h1>
<div class="section" id="how-roverlay-works">
<h2><a class="toc-backref" href="#contents">4.1&nbsp;&nbsp;&nbsp;How <em>roverlay</em> works</a></h2>
<p>These are the steps that <em>roverlay</em> performs:</p>
<ol class="arabic simple">
<li><strong>sync</strong> - get R packages using various methods
(rsync, http, local directory)</li>
<li>scan the R Overlay directory (if it exists) for valid ebuilds</li>
<li>queue all R packages for ebuild creation<ul>
<li>all repositories are asked to list their packages which are then added
to a queue</li>
<li>packages may be declined by the overlay creator if they already have
an ebuild</li>
</ul>
</li>
<li><strong>create</strong> - process each package <em>p</em> from the package queue
(thread-able on a per package basis)</li>
</ol>
<blockquote>
<ul>
<li><p class="first">read <em>p</em>'s DESCRIPTION file that contains information fields
like 'Depends', 'Description' and 'Suggests'</p>
</li>
<li><p class="first">resolve <em>p</em>'s dependencies</p>
<ul>
<li><p class="first">differentiate between <em>required</em> and <em>optional</em> dependencies
(for example, dependencies from the 'Depends' field are required,
while those from 'Suggests' are optional)</p>
</li>
<li><p class="first"><strong>immediately stop</strong> processing <em>p</em> if a <em>required</em> dependency
cannot be resolved in which case a valid ebuild cannot be created</p>
<p>See also: <a class="reference internal" href="#dependency-resolution">Dependency Resolution</a></p>
</li>
</ul>
</li>
<li><p class="first">create an ebuild for <em>p</em> by using the dependency resolution results
and a few information fields like 'Description'</p>
</li>
<li><p class="first"><strong>done</strong> with <em>p</em> - the overlay creator takes control over <em>p</em>
and may decide to write <em>p</em>'s ebuild now (or later)</p>
</li>
</ul>
</blockquote>
<ol class="arabic simple" start="5">
<li>write the overlay<ul>
<li>write all ebuilds
(thread-able on a per package basis)</li>
<li>write the <em>metadata.xml</em> files
(thread-able on a per package basis)<ul>
<li>this uses the latest created ebuild available for a package</li>
</ul>
</li>
<li>write the <em>Manifest</em> files
(not thread-able)<ul>
<li>this uses all ebuilds availabe for a package</li>
</ul>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="expected-overlay-result-structure-of-the-generated-overlay">
<h2><a class="toc-backref" href="#contents">4.2&nbsp;&nbsp;&nbsp;Expected Overlay Result / Structure of the generated overlay</a></h2>
<p>Assuming that the default configuration (where possible) and the <em>R-packages</em>
eclass file are used, the result should look like:</p>
<pre class="code text literal-block">
&lt;overlay root&gt;/
&lt;overlay root&gt;/eclass
&lt;overlay root&gt;/eclass/R-packages.eclass
&lt;overlay root&gt;/profiles
&lt;overlay root&gt;/profiles/categories
&lt;overlay root&gt;/profiles/repo_name
&lt;overlay root&gt;/profiles/use.desc
&lt;overlay root&gt;/sci-R/&lt;many directories per R package&gt;
&lt;overlay root&gt;/sci-R/seewave/
&lt;overlay root&gt;/sci-R/seewave/Manifest
&lt;overlay root&gt;/sci-R/seewave/metadata.xml
&lt;overlay root&gt;/sci-R/seewave/seewave-1.5.9.ebuild
&lt;overlay root&gt;/sci-R/seewave/seewave-1.6.4.ebuild
</pre>
<div class="section" id="expected-ebuild-result">
<h3><a class="toc-backref" href="#contents">4.2.1&nbsp;&nbsp;&nbsp;Expected Ebuild Result</a></h3>
<dl class="docutils">
<dt>Ebuild Template</dt>
<dd><pre class="code text first literal-block">
&lt;ebuild header&gt;
inherit &lt;eclass(es)&gt;

DESCRIPTION=&quot;&lt;the R package's description&gt;&quot;
SRC_URI=&quot;&lt;src uri for the R package&gt;&quot;

IUSE=&quot;${IUSE:-}
   R_suggests
&quot;
R_SUGGESTS=&quot;&lt;R package suggestions&gt;&quot;
DEPEND=&quot;&lt;build time dependencies for the R package&gt;&quot;
RDEPEND=&quot;${DEPEND:-}
   &lt;runtime dependencies&gt;
   R_suggests? ( ${R_SUGGESTS} )
&quot;

_UNRESOLVED_PACKAGES=(&lt;unresolvable, but optional dependencies&gt;)
</pre>
<p>Some of the variables may be missing if they are not needed.</p>
<p>A really minimal ebuild would look like:</p>
<pre class="code text last literal-block">
&lt;ebuild header&gt;
inherit &lt;eclass(es)&gt;

SRC_URI=&quot;&lt;src uri for the R package&gt;&quot;
</pre>
</dd>
<dt>Example: seewave 1.6.4 from CRAN:</dt>
<dd><p class="first">The default ebuild header (which cannot be changed) automatically sets
the ebuild's copyright year to 1999-<em>&lt;current year&gt;</em>.</p>
<pre class="code sh last literal-block">
<span class="c"># Copyright 1999-2012 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: $
</span>
<span class="nv">EAPI</span><span class="o">=</span>4
inherit R-packages

<span class="nv">DESCRIPTION</span><span class="o">=</span><span class="s2">&quot;Time wave analysis and graphical representation&quot;</span>
<span class="nv">SRC_URI</span><span class="o">=</span><span class="s2">&quot;http://cran.r-project.org/src/contrib/seewave_1.6.4.tar.gz&quot;</span>

<span class="nv">IUSE</span><span class="o">=</span><span class="s2">&quot;${IUSE:-}
   R_suggests
&quot;</span>
<span class="nv">R_SUGGESTS</span><span class="o">=</span><span class="s2">&quot;sci-R/sound
   sci-R/audio
&quot;</span>
<span class="nv">DEPEND</span><span class="o">=</span><span class="s2">&quot;sci-R/fftw
   sci-R/tuneR
   &gt;=dev-lang/R-2.15.0
   sci-R/rpanel
   sci-R/rgl
&quot;</span>
<span class="nv">RDEPEND</span><span class="o">=</span><span class="s2">&quot;${DEPEND:-}
   media-libs/flac
   sci-libs/fftw
   media-libs/libsndfile
   R_suggests? ( ${R_SUGGESTS} )
&quot;</span>
</pre>
</dd>
<dt>Example: MetaPCA 0.1.3 from CRAN's archive:</dt>
<dd><p class="first">Note the shortened <em>DESCRIPTION</em> variable that points to the <em>metadata.xml</em>
file. This happens if the description is too long.</p>
<pre class="code sh last literal-block">
<span class="c"># Copyright 1999-2012 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: $
</span>
<span class="nv">EAPI</span><span class="o">=</span>4
inherit R-packages

<span class="nv">DESCRIPTION</span><span class="o">=</span><span class="s2">&quot;MetaPCA: Meta-analysis in the Di... (see metadata)&quot;</span>
<span class="nv">SRC_URI</span><span class="o">=</span><span class="s2">&quot;http://cran.r-project.org/src/contrib/Archive/MetaPCA/MetaPCA_0.1.3.tar.gz&quot;</span>

<span class="nv">IUSE</span><span class="o">=</span><span class="s2">&quot;${IUSE:-}
   R_suggests
&quot;</span>
<span class="nv">R_SUGGESTS</span><span class="o">=</span><span class="s2">&quot;sci-R/doMC
   sci-R/affy
   sci-R/ellipse
   sci-R/pcaPP
   sci-R/MASS
   sci-R/impute
   sci-R/doSMP
   sci-R/GEOquery
&quot;</span>
<span class="nv">DEPEND</span><span class="o">=</span><span class="s2">&quot;sci-R/foreach&quot;</span>
<span class="nv">RDEPEND</span><span class="o">=</span><span class="s2">&quot;${DEPEND:-}
   R_suggests? ( ${R_SUGGESTS} )
&quot;</span>

<span class="nv">_UNRESOLVED_PACKAGES</span><span class="o">=(</span><span class="s1">'hgu133plus2.db'</span><span class="o">)</span>
</pre>
</dd>
</dl>
</div>
<div class="section" id="expected-metadata-xml-result">
<h3><a class="toc-backref" href="#contents">4.2.2&nbsp;&nbsp;&nbsp;Expected <em>metadata.xml</em> Result</a></h3>
<p>The <em>metadata.xml</em> will contain the full description for the latest version
of a package.</p>
<dl class="docutils">
<dt>Example: seewave from CRAN</dt>
<dd><p class="first">Note the ' // ' delimiter. It will be used to separate description strings
if a package has more than one, e.g. one in its <em>Title</em> and one in its
<em>Description</em> information field.</p>
<pre class="code xml last literal-block">
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE pkgmetadata SYSTEM &quot;http://www.gentoo.org/dtd/metadata.dtd&quot;&gt;</span>
<span class="nt">&lt;pkgmetadata&gt;</span>
   <span class="nt">&lt;longdescription&gt;</span>
      Time wave analysis and graphical representation // seewave
      provides functions for analysing, manipulating, displaying,
      editing and synthesizing time waves (particularly sound).  This
      package processes time analysis (oscillograms and envelopes),
      spectral content, resonance quality factor, entropy, cross
      correlation and autocorrelation, zero-crossing, dominant
      frequency, analytic signal, frequency coherence, 2D and 3D
      spectrograms and many other analyses.
   <span class="nt">&lt;/longdescription&gt;</span>
<span class="nt">&lt;/pkgmetadata&gt;</span>
</pre>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="repositories-getting-packages">
<span id="repositories"></span><h1><a class="toc-backref" href="#contents">5&nbsp;&nbsp;&nbsp;Repositories / Getting Packages</a></h1>
<p><em>roverlay</em> is capable of downloading R packages via rsync and http,
and is able to use any packages locally available. The method used to get and
use the packages is determined by the concrete <strong>type of a repository</strong>,
which is the topic of this section. It also covers repository configuration.</p>
<div class="section" id="a-word-about-repo-config-files">
<span id="repo-config"></span><h2><a class="toc-backref" href="#contents">5.1&nbsp;&nbsp;&nbsp;A word about repo config files</a></h2>
<p>Repo config files use <a class="reference external" href="http://docs.python.org/library/configparser.html">ConfigParser</a> syntax (known from ini files).</p>
<p>Each repo entry section is introduced with <tt class="docutils literal">[&lt;repo name&gt;]</tt> and defines</p>
<ul class="simple">
<li>how <em>roverlay</em> can download the R packages from a repo
and where they should be stored</li>
<li>how ebuilds can download the packages (-&gt; <em>SRC_URI</em>)</li>
<li>repo type specific options, e.g. whether the repo supports package file
verification</li>
</ul>
<p>Such options are declared with <tt class="docutils literal">&lt;option&gt; = &lt;value&gt;</tt> in the repo entry.</p>
<p id="repo-config-options">The common options for repository entries are:</p>
<ul>
<li><p class="first"><em>type</em> (optional), which declares the repository type.
Available types are:</p>
<ul class="simple">
<li><a class="reference internal" href="#rsync">rsync</a></li>
<li><a class="reference internal" href="#websync-repo">websync_repo</a></li>
<li><a class="reference internal" href="#websync-pkglist">websync_pkglist</a></li>
<li><a class="reference internal" href="#local">local</a></li>
</ul>
<p>Defaults to <em>rsync</em>.</p>
</li>
<li><p class="first"><em>src_uri</em> (<strong>required</strong>),
which declares how ebuilds can download the packages.
Some repo types use this for downloading, too.</p>
</li>
<li><p class="first"><em>directory</em> (optional),
which explicitly sets the package directory to use.
The default behavior is to use <a class="reference internal" href="#distfiles-root">DISTFILES_ROOT</a>/&lt;repo name&gt;</p>
</li>
</ul>
<div class="hint">
<p class="first admonition-title">Hint</p>
<p class="last">Repo names are allowed contain slashes, which will be respected when
creating the default directory.</p>
</div>
</div>
<div class="section" id="rsync-repos">
<span id="rsync"></span><h2><a class="toc-backref" href="#contents">5.2&nbsp;&nbsp;&nbsp;Rsync repos</a></h2>
<p>Runs <em>rsync</em> to download packages. Automatic sync retries are supported if
<em>rsync</em>'s exit code indicates chances of success.
For example, up to 3 retries are granted if <em>rsync</em> returns
<em>Partial transfer due to vanished source files</em> which likely happens when
syncing big repositories like CRAN.</p>
<p>This repo type extends the default options by:</p>
<ul class="simple">
<li><em>rsync_uri</em> (<strong>required</strong>), which specifies the uri used for syncing</li>
<li><em>recursive</em> (optional), which passes <tt class="docutils literal"><span class="pre">--recursive</span></tt> to <em>rsync</em> if set to
'yes'</li>
<li><em>extra_rsync_opts</em> (optional), which passes arbitrary options to <em>rsync</em>.
This can be used include/exclude files or to show progress during transfer.
Options with whitespace are not supported.</li>
</ul>
<p>Examples:</p>
<ul>
<li><p class="first">CRAN</p>
<blockquote>
<pre class="code ini literal-block">
<span class="k">[CRAN]</span>
<span class="na">type</span>             <span class="o">=</span> <span class="s">rsync</span>
<span class="na">rsync_uri</span>        <span class="o">=</span> <span class="s">cran.r-project.org::CRAN/src/contrib</span>
<span class="na">src_uri</span>          <span class="o">=</span> <span class="s">http://cran.r-project.org/src/contrib</span>
<span class="na">extra_rsync_opts</span> <span class="o">=</span> <span class="s">--progress --exclude=PACKAGES --exclude=PACKAGES.gz</span>
</pre>
</blockquote>
</li>
<li><p class="first">CRAN's archive:</p>
<blockquote>
<pre class="code ini literal-block">
<span class="k">[CRAN-Archive]</span>
<span class="na">type</span>             <span class="o">=</span> <span class="s">rsync</span>
<span class="na">rsync_uri</span>        <span class="o">=</span> <span class="s">cran.r-project.org::CRAN/src/contrib/Archive</span>
<span class="na">src_uri</span>          <span class="o">=</span> <span class="s">http://cran.r-project.org/src/contrib/Archive</span>
<span class="na">extra_rsync_opts</span> <span class="o">=</span> <span class="s">--progress</span>
<span class="na">recursive</span>        <span class="o">=</span> <span class="s">yes</span>
</pre>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="getting-packages-from-a-repository-that-supports-http-only">
<span id="websync-repo"></span><h2><a class="toc-backref" href="#contents">5.3&nbsp;&nbsp;&nbsp;Getting packages from a repository that supports http only</a></h2>
<p>This is your best bet if the remote is a repository but does not offer rsync
access. Basic digest verification is supported (MD5). The remote has to have
a package list file, typically named <em>PACKAGES</em>,
with a special syntax (debian control file syntax).</p>
<p>A package list example,
excerpt from <a class="reference external" href="http://www.omegahat.org/R/src/contrib/PACKAGES">omegahat's PACKAGES file</a> (as of Aug 2012):</p>
<pre class="code control literal-block">
<span class="err">...</span>
<span class="k">Package</span><span class="w">: </span><span class="s">CGIwithR</span>
<span class="k">Version</span>: <span class="m">0.73-0</span>
<span class="k">Suggests</span><span class="w">: </span><span class="s">GDD</span>
<span class="k">License</span><span class="w">: </span><span class="s">GPL (&gt;= 2)</span>
<span class="k">MD5sum</span><span class="w">: </span><span class="s">50b1f48209c9e66909c7afb3a4b8af5e</span>

<span class="k">Package</span><span class="w">: </span><span class="s">CodeDepends</span>
<span class="k">Version</span>: <span class="m">0.2-1</span>
<span class="k">Depends</span>: <span class="nf">methods</span>
<span class="k">Imports</span><span class="w">: </span><span class="s">codetools, XML</span>
<span class="k">Suggests</span><span class="w">: </span><span class="s">graph, Rgraphviz</span>
<span class="k">License</span><span class="w">: </span><span class="s">GPL</span>
<span class="k">MD5sum</span><span class="w">: </span><span class="s">e2ec3505f9db1a96919a72f07673a2d8</span>
<span class="err">...</span>
</pre>
<p>An example repo config entry for omegahat:</p>
<pre class="code ini literal-block">
<span class="k">[omegahat]</span>
<span class="na">type</span>    <span class="o">=</span> <span class="s">websync_repo</span>
<span class="na">src_uri</span> <span class="o">=</span> <span class="s">http://www.omegahat.org/R/src/contrib</span>
<span class="na">digest</span>  <span class="o">=</span> <span class="s">md5</span>
<span class="c">#digest = none</span>
</pre>
<p>This repo type extends the default options by:</p>
<ul class="simple">
<li><em>digest</em>, which declares that the remote supports digest based package file
verification. Accepted values are 'md5' and 'none'. Defaults to 'none',
which disables verification.</li>
<li><em>pkglist_file</em>, which sets the name of the package list file and defaults
to PACKAGES</li>
<li><em>pkglist_uri</em>, which explicitly sets the uri of the package list file.
Defaults to <em>src_uri</em>/<em>pkglist_file</em></li>
</ul>
<p>None of these options are required.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">The content type of the remote's package list file has to be exactly
<em>text/plain</em>, compressed files are not supported.</p>
</div>
</div>
<div class="section" id="getting-packages-from-several-remotes-using-http-and-a-package-list">
<span id="websync-pkglist"></span><h2><a class="toc-backref" href="#contents">5.4&nbsp;&nbsp;&nbsp;Getting packages from several remotes using http and a package list</a></h2>
<p>This is not a real repository type, instead it creates a <em>local</em> repository
by downloading single R packages from different remotes.
Its only requirement is that a package is downloadable via http.
Apart from an entry in the repo config file, it also needs a file that lists
one package uri per line:</p>
<pre class="code text literal-block">
...
http://cran.r-project.org/src/contrib/seewave_1.6.4.tar.gz
http://download.r-forge.r-project.org/src/contrib/zoo_1.7-7.tar.gz
http://www.omegahat.org/R/src/contrib/Aspell_0.2-0.tar.gz
...
</pre>
<p>Comments are not supported. Assuming that such a package list exists at
<em>~/roverlay/config/http_packages.list</em>, an example entry in the repo config
file would be:</p>
<pre class="code ini literal-block">
<span class="k">[http-packages]</span>
<span class="na">type</span>    <span class="o">=</span> <span class="s">websync_pkglist</span>
<span class="na">pkglist</span> <span class="o">=</span> <span class="s">~/roverlay/config/http_packages.list</span>
</pre>
<p>This repo type extends the default options by:</p>
<ul class="simple">
<li><em>pkglist</em>, which sets the package list file. This option is <strong>required</strong>.</li>
</ul>
</div>
<div class="section" id="using-local-directories">
<span id="local"></span><h2><a class="toc-backref" href="#contents">5.5&nbsp;&nbsp;&nbsp;Using local directories</a></h2>
<p>Using local package directories is possible, too.</p>
<p>Example:</p>
<pre class="code ini literal-block">
<span class="k">[local-packages]</span>
<span class="na">type</span>      <span class="o">=</span> <span class="s">local</span>
<span class="na">directory</span> <span class="o">=</span> <span class="s">/var/local/R-packages</span>
<span class="na">src_uri</span>   <span class="o">=</span> <span class="s">http://localhost/R-packages</span>
</pre>
<p>This will use all packages from <em>/var/local/R-packages</em> and assumes
that they are available via <em>http://localhost/R-packages</em>.</p>
<p>A local directory will never be modified.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<p class="last">Using this repo type is <strong>not recommended for production usage</strong> because
the <em>SRC_URI</em> variable in created ebuilds will be invalid unless you have
downloaded all packages from the same remote in which case you should
consider using one of the <strong>websync</strong> repo types, <a class="reference internal" href="#websync-repo">websync_repo</a> and
<a class="reference internal" href="#websync-pkglist">websync_pkglist</a>.</p>
</div>
</div>
</div>
<div class="section" id="dependency-rules">
<h1><a class="toc-backref" href="#contents">6&nbsp;&nbsp;&nbsp;Dependency Rules</a></h1>
<div class="section" id="simple-dependency-rules">
<h2><a class="toc-backref" href="#contents">6.1&nbsp;&nbsp;&nbsp;Simple Dependency Rules</a></h2>
<p><em>Simple dependency rules</em> use a dictionary and string transformations
to resolve dependencies. <em>Fuzzy simple dependency rules</em> extend these by
a set of regular expressions, which allows to resolve many dependency strings
that minimally differ (e.g. only in the required version and/or comments:
<cite>R (&gt;= 2.10)</cite> and <cite>R [2.14] from http://www.r-project.org/</cite>) with a single
dictionary entry.</p>
<p>This is the only rule implementation currently available.</p>
<div class="section" id="rule-variants">
<h3><a class="toc-backref" href="#contents">6.1.1&nbsp;&nbsp;&nbsp;Rule Variants</a></h3>
<dl class="docutils">
<dt>default</dt>
<dd>The expected behavior of a dictionary-based rule: It matches one or more
<em>dependency string(s)</em> and resolves them as a <em>dependency</em>.</dd>
<dt>ignore</dt>
<dd>This variant will ignore <em>dependency strings</em>. Technically, it will
resolve them as <strong>nothing</strong>.</dd>
</dl>
</div>
<div class="section" id="rule-types">
<h3><a class="toc-backref" href="#contents">6.1.2&nbsp;&nbsp;&nbsp;Rule types</a></h3>
<dl class="docutils">
<dt>Simple Rules</dt>
<dd><p class="first">A simple rule resolves <strong>exact string matches</strong> (case-insensitive).</p>
<p>Example:
Given a rule <em>R</em> that says &quot;resolve 'R' and 'the R programming language'
as 'dev-lang/R'&quot;, any of these <em>dependency strings</em> will be resolved
as dev-lang/R:</p>
<ul class="last simple">
<li>r</li>
<li>THE R PROGRAMMING LanGuAgE</li>
<li>R</li>
</ul>
</dd>
<dt>Fuzzy Rules</dt>
<dd><p class="first">Fuzzy Rules are <strong>extended Simple Rules</strong>. If the basic lookup
as described above fails for a <em>dependency string</em>,
they will <em>try</em> to resolve it as a <strong>version-relative match</strong>.</p>
<p>To do this, the <em>dependency string</em> will be split into components like
<em>dependency name</em>, <em>dependency version</em> and useless comments, which are
discarded.
Then, if the <em>dependency name</em> matches a dictionary entry, a resolving
<em>dependency</em> will be created.</p>
<dl class="last docutils">
<dt>Example:</dt>
<dd><p class="first">Given the same rule as in the Simple Rules example, but as fuzzy rule
&quot;fuzzy-resolve 'R' and 'the R programming language' as 'dev-lang/R'&quot;,
it will resolve any of these <em>dependency strings</em>:</p>
<ul class="last simple">
<li>&quot;r&quot; as &quot;dev-lang/R&quot;</li>
<li>&quot;R 2.12&quot; as &quot;&gt;=dev-lang/R-2.12&quot;</li>
<li>&quot;The R PROGRAMMING LANGUAGE [&lt;2.14] from <a class="reference external" href="http://www.r-project.org/">http://www.r-project.org/</a>&quot;
as &quot;&lt;dev-lang/R-2.14&quot;</li>
<li>&quot;R ( !2.10 )&quot; as &quot;( !=dev-lang/R-2.10 dev-lang/R )&quot;</li>
</ul>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="rule-file-examples">
<h3><a class="toc-backref" href="#contents">6.1.3&nbsp;&nbsp;&nbsp;Rule File Examples</a></h3>
<p>This sections lists some rule file examples.
See <a class="reference internal" href="#rule-file-syntax">Rule File Syntax</a> for a formal description.</p>
<dl class="docutils">
<dt>Example 1 - <em>default</em> fuzzy rule</dt>
<dd><p class="first">A rule that matches many dependencies on dev-lang/R, for example
&quot;r 2.12&quot;, &quot;R(&gt;= 2.14)&quot;, &quot;R [&lt;2.10]&quot;, &quot;r{  !2.12 }&quot;, and &quot;R&quot;, and
resolves them as '&gt;=dev-lang/R-2.12', '&gt;=dev-lang/R-2.14',
'&lt;dev-lang/R-2.10', etc.:</p>
<pre class="code text last literal-block">
~dev-lang/R :: R
</pre>
</dd>
<dt>Example 2 - <em>default</em> simple rule stub</dt>
<dd><p class="first">A rule that case-insensitively matches 'zoo' and resolves it as 'sci-R/zoo',
assuming the OVERLAY_CATEGORY is set to 'sci-R':</p>
<pre class="code text literal-block">
zoo
</pre>
<div class="note last">
<p class="first admonition-title">Note</p>
<p class="last">R Package rules are dynamically created at runtime and therefore not
needed. Write them only if certain R package dependencies cannot
be resolved. See <em>Selfdep</em> in <a class="reference internal" href="#rule-file-syntax">Rule File Syntax</a> for details.</p>
</div>
</dd>
<dt>Example 3 - <em>default</em> simple rule</dt>
<dd><p class="first">A rule that matches several <em>dependency strings</em> and resolves them
as &quot;sci-libs/gdal and sci-libs/proj&quot;:</p>
<pre class="code text last literal-block">
( sci-libs/gdal sci-libs/proj ) {
   for building from source: GDAL &gt;= 1.3.1 &amp;&amp; GDAL &lt; 1.6.0 (until tested) library and PROJ.4 (proj &gt;= 4.4.9)
   for building from source: GDAL &gt;= 1.3.1 library and PROJ.4 (proj &gt;= 4.4.9)
   for building from source: GDAL &gt;= 1.3.1 library and PROJ.4(proj &gt;= 4.4.9)
   for building from source: GDAL &gt;= 1.6.0 library and PROJ.4(proj &gt;= 4.4.9)
}
</pre>
</dd>
<dt>Example 4 - <em>ignore</em> simple rule</dt>
<dd><p class="first">A rule that matches text that should be ignored.
This is a good way to deal with free-style text found
in some R package DESCRIPTION files.</p>
<pre class="code text last literal-block">
! {
   see README
   read INSTALL
   Will use djmrgl or rgl packages for rendering if present
}
</pre>
</dd>
</dl>
<p>Please see the default rule files for more extensive examples that cover
other aspects like limiting a rule to certain dependency types.
They can be found in <em>/etc/roverlay/simple-deprules.d</em> if <em>roverlay</em> has been
installed with <em>emerge</em>, else in <em>&lt;R Overlay src directory&gt;/simple-deprules.d</em>.</p>
</div>
<div class="section" id="rule-file-syntax">
<span id="dependency-rule-file-syntax"></span><h3><a class="toc-backref" href="#contents">6.1.4&nbsp;&nbsp;&nbsp;Rule File Syntax</a></h3>
<p>Simple dependency rule files have a special syntax. Each rule is introduced
with the resolving <em>dependency</em> prefixed by a <em>keychar</em> that sets the rule
type if required. The <em>dependency strings</em> resolved by this rule are listed
after a rule separator or within a rule block. Leading/trailing whitespace
is ignored.</p>
<dl class="docutils">
<dt>Ignore rules</dt>
<dd>have only a keychar but no <em>dependency</em>.</dd>
<dt>Keychars</dt>
<dd><p class="first">set the rule type.</p>
<ul class="simple">
<li><strong>!</strong> introduces a <em>ignore</em> simple rule</li>
<li><strong>~</strong> introduces a <em>default</em> fuzzy rule</li>
<li><strong>%</strong> introduces a <em>ignore</em> fuzzy rule</li>
</ul>
<p class="last">Anything else is not treated as keychar and thus introduces a <em>default</em>
simple rule.</p>
</dd>
<dt>Keywords</dt>
<dd><p class="first">There are two keywords that control how a rule file is read.</p>
<p>The important one is the <em>#deptype &lt;dependency type&gt;</em> directive that
defines that all rules until the next <em>deptype</em> directory or end of file,
whatever comes first, will only match <em>dependency strings</em>
with the specified <em>dependency type</em>.</p>
<p>Available dependency types are</p>
<ul class="simple">
<li><em>all</em> (no type restrictions)</li>
<li><em>pkg</em> (resolve only R package dependencies)</li>
<li><em>sys</em> (resolve only system dependencies)</li>
</ul>
<p class="last">The other keyword is <em>#! NOPARSE</em> which stops parsing of a rule file.</p>
</dd>
<dt>Dependencies</dt>
<dd><p class="first">are strings that are recognized by portage as <strong>Dynamic DEPENDs</strong>
(see the ebuild(5) man page).</p>
<p>Examples:</p>
<blockquote>
<ul class="simple">
<li>dev-lang/R</li>
<li>( media-libs/tiff &gt;=sci-libs/fftw-3 )</li>
<li>&gt;=x11-drivers/nvidia-drivers-270</li>
</ul>
</blockquote>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">The fuzzy rule types support <strong>DEPEND Atom Bases</strong> only.</p>
</div>
<div class="warning last">
<p class="first admonition-title">Warning</p>
<p class="last">Dependency strings cannot start with <em>~</em> as it is a keychar.
Use braces <em>( ~... )</em> to work around that.</p>
</div>
</dd>
<dt>Single line rules</dt>
<dd><p class="first">resolve exactly one <em>dependency string</em>. Their rule separator is ' :: '.</p>
<dl class="last docutils">
<dt>Syntax:</dt>
<dd><pre class="code text first last literal-block">
[&lt;keychar&gt;]&lt;dependency&gt; :: &lt;dependency string&gt;
</pre>
</dd>
</dl>
</dd>
<dt>Multi line rules</dt>
<dd><p class="first">resolve several <em>dependency strings</em>.
Their rule block begins with '{' + newline, followed by one
<em>dependency string</em> per line, and ends with '}' in a separate line.</p>
<dl class="docutils">
<dt>Syntax:</dt>
<dd><pre class="code text first last literal-block">
[&lt;keychar&gt;]&lt;dependency&gt; {
   &lt;dependency string&gt;
   [&lt;dependency string&gt;]
   ...
}
</pre>
</dd>
</dl>
<div class="note last">
<p class="first admonition-title">Note</p>
<p class="last">Technically, this rule syntax can be used to specify rules with
zero or more <em>dependency strings</em>. An empty rule makes little sense,
though.</p>
</div>
</dd>
<dt>Comments</dt>
<dd>start with <strong>#</strong>. There are a few exceptions to that, the <em>#deptype</em> and
<em>#! NOPARSE</em> keywords. Comments inside rule blocks are not allowed and
will be read as normal <em>dependency strings</em>.</dd>
<dt>Selfdep</dt>
<dd><p class="first">This is another name for <em>dependency strings</em> that are resolved by an
R package with the same name, which is also part of the overlay being
created.</p>
<p>Example: <em>zoo</em> is resolved as <em>sci-R/zoo</em>, assuming that <a class="reference internal" href="#overlay-category">OVERLAY_CATEGORY</a>
is set to <em>sci-R</em></p>
<p>Writing selfdep rules is not necessary since <em>roverlay</em> automatically
creates rules for all known R packages (see <a class="reference internal" href="#dynamic-selfdep-rule-pool">Dynamic Selfdep Rule Pool</a>
for details).</p>
<p>There are a few exceptions to that in which case selfdep rules have to
be written:</p>
<ul class="simple">
<li>The <em>dependency string</em> is assumed to be a system dependency (not an
R package). This is likely a &quot;bug&quot; in the DESCRIPTION file of the
R package being processed.</li>
<li>The R package name is not ebuild-name compliant (e.g. contains the '.'
char, which is remapped to '_'.).
Most <em>char remap</em> cases are handled properly, but there may be a few
exceptions.</li>
</ul>
<div class="caution last">
<p class="first admonition-title">Caution!</p>
<p class="last">Writing unnecessary selfdep rules slows dependency resolution down!
Each rule will exist twice, once as <em>dynamic</em> rule and once as
the written one.</p>
</div>
</dd>
<dt>Rule Stubs</dt>
<dd><p class="first">Selfdeps can be written using a shorter syntax.
For example, if your OVERLAY_CATEGORY is <em>sci-R</em>, <em>zoo</em> should be resolved
as <em>sci-R/zoo</em>. This rule can be written as a single word, <em>zoo</em>.</p>
<dl class="last docutils">
<dt>Syntax:</dt>
<dd><pre class="code text first last literal-block">
[&lt;keychar&gt;]&lt;short dependency&gt;
</pre>
</dd>
</dl>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="configuration-reference">
<h1><a class="toc-backref" href="#contents">7&nbsp;&nbsp;&nbsp;Configuration Reference</a></h1>
<p>The main config file uses '&lt;option&gt; = &lt;value&gt;' syntax, comment lines start
with <strong>#</strong>. Variable substitution (&quot;${X}&quot;) is not supported. Quotes around
the value are optional and allow to span long values over multiple lines.
Whitespace is ignored, file <strong>paths must not contain whitespace</strong>.</p>
<p>Some options have value type restrictions. These <em>value types</em> are used:</p>
<dl class="docutils">
<dt>log_level</dt>
<dd>Value has to be a log level. Available choise are <em>DEBUG</em>, <em>INFO</em>, <em>WARN</em>,
<em>WARNING</em>, <em>ERROR</em> and <em>CRITICAL</em>.</dd>
<dt>bool</dt>
<dd><p class="first">Value is a string that represents a boolean value.</p>
<p>This table illustrates which value strings are accepted:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">string value</th>
<th class="head">boolean value</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>y, yes, on, 1, true, enabled</td>
<td><em>True</em></td>
</tr>
<tr><td>n, no, off, 0, false, disabled</td>
<td><em>False</em></td>
</tr>
<tr><td><em>&lt;any other value&gt;</em></td>
<td><strong>not allowed</strong></td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>There are also some implicit <em>value types</em>:</p>
<dl class="docutils">
<dt>list</dt>
<dd>This means that a option has several values that are separated by
whitespace. Quotation marks have to be used to specify more than one
value.</dd>
<dt>file, dir</dt>
<dd>A value that represents a file system location will be expanded ('~' will
be replaced by the user's home etc.).
Additionaly the value has to be a file (or directory) if it exists.</dd>
<dt>&lt;empty&gt;</dt>
<dd>Specifying empty values often leads to errors if an option has value type
restrictions. Commenting it out is safe.</dd>
</dl>
<p>The following sections will list all config entries.</p>
<div class="section" id="misc-options">
<h2><a class="toc-backref" href="#contents">7.1&nbsp;&nbsp;&nbsp;misc options</a></h2>
<dl class="docutils" id="distfiles">
<dt>DISTFILES</dt>
<dd>Alias to <a class="reference internal" href="#distfiles-root">DISTFILES_ROOT</a>.</dd>
</dl>
<dl class="docutils" id="distfiles-root">
<dt>DISTFILES_ROOT</dt>
<dd><p class="first">The root directory of per-repository package directories. Repos will create
their package directories in this directory unless they specify another
location (see <a class="reference internal" href="#repo-config-options">repo config options</a>).</p>
<p class="last">This option is <strong>required</strong>.</p>
</dd>
</dl>
<dl class="docutils" id="distroot">
<dt>DISTROOT</dt>
<dd>Alias to <a class="reference internal" href="#distfiles-root">DISTFILES_ROOT</a>.</dd>
</dl>
<dl class="docutils" id="ebuild-prog">
<dt>EBUILD_PROG</dt>
<dd><p class="first">Name or path of the ebuild executables that is required for (external)
Manifest file creation. A wrong value will cause ebuild creation late,
which is a huge time loss, so make sure that this option is properly set.</p>
<p class="last">Defaults to <em>ebuild</em>, which should be fine in most cases.</p>
</dd>
</dl>
<dl class="docutils" id="rsync-bwlimit">
<dt>RSYNC_BWLIMIT</dt>
<dd><p class="first">Set a max. average bandwidth usage in kilobytes per second.
This will pass '--bwlimit=&lt;value&gt;' to all rsync commands.</p>
<p class="last">Defaults to &lt;not set&gt;, which disables bandwidth limitation.</p>
</dd>
</dl>
</div>
<div class="section" id="overlay-options">
<h2><a class="toc-backref" href="#contents">7.2&nbsp;&nbsp;&nbsp;overlay options</a></h2>
<dl class="docutils" id="eclass">
<dt>ECLASS</dt>
<dd>Alias to <a class="reference internal" href="#overlay-eclass">OVERLAY_ECLASS</a>.</dd>
</dl>
<dl class="docutils" id="overlay-category">
<dt>OVERLAY_CATEGORY</dt>
<dd><p class="first">Sets the category of created ebuilds. There are no value type restrictions
for this option, but values with a slash <em>/</em> lead to errors.</p>
<p class="last">Defaults to <em>sci-R</em>.</p>
</dd>
</dl>
<dl class="docutils" id="overlay-dir">
<dt>OVERLAY_DIR</dt>
<dd><p class="first">Sets the directory of the overlay that will be created.</p>
<p class="last">This option is <strong>required</strong>.</p>
</dd>
</dl>
<dl class="docutils" id="overlay-eclass">
<dt>OVERLAY_ECLASS</dt>
<dd><p class="first">A list of eclass files that will be imported into the overlay and inherited
in all created ebuilds.
Note that overlay creation fails if any of the specified eclass files
cannot be imported.
Eclass files must end with '.eclass' or have no file extension.</p>
<p class="last">Defaults to &lt;not set&gt;, which means that no eclass files will be used.
This is <strong>not useful</strong>, since created ebuilds rely on an eclass for phase
functions like <em>src_install()</em>.</p>
</dd>
</dl>
<dl class="docutils" id="overlay-keep-nth-latest">
<dt>OVERLAY_KEEP_NTH_LATEST</dt>
<dd><p class="first">Setting this option to a value &gt; 0 enables keeping of max. <em>value</em> ebuilds
per R package. All others will be removed.</p>
<p class="last">Defaults to &lt;not set&gt;, which disables this feature and keeps all ebuilds.</p>
</dd>
</dl>
<dl class="docutils" id="overlay-name">
<dt>OVERLAY_NAME</dt>
<dd><p class="first">Sets the name of the created overlay that will be written into
<em>OVERLAY_DIR/profiles/repo_name</em>. This file will be rewritten on every
<em>roverlay</em> run that includes the <em>create</em> command.</p>
<p class="last">Defaults to <em>R_Overlay</em>.</p>
</dd>
</dl>
</div>
<div class="section" id="other-config-files">
<h2><a class="toc-backref" href="#contents">7.3&nbsp;&nbsp;&nbsp;other config files</a></h2>
<p>Some config config options are split from the main config file for various
reasons:</p>
<ul class="simple">
<li>no need for modification in most cases, e.g. the <a class="reference internal" href="#id2">field definition</a> file</li>
<li>special syntax that is not compatible with the main config file,
e.g. the <a class="reference internal" href="#dependency-rule-file-syntax">dependency rule file syntax</a></li>
</ul>
<p>The paths to these files have to be listed in the main config file and
can be overridden with the appropriate command line options.</p>
<dl class="docutils" id="field-definition">
<dt>FIELD_DEFINITION</dt>
<dd><p class="first">Path to the field definition file that controls how the <em>DESCRIPTION</em> file
of R packages is read.</p>
<p class="last">This option is <strong>required</strong>.</p>
</dd>
</dl>
<dl class="docutils" id="field-definition-file">
<dt>FIELD_DEFINITION_FILE</dt>
<dd>Alias to <a class="reference internal" href="#field-definition">FIELD_DEFINITION</a>.</dd>
</dl>
<dl class="docutils" id="id1">
<dt>REPO_CONFIG</dt>
<dd><p class="first">A list of one or more repo config files.</p>
<p class="last">This option is <strong>required</strong>.</p>
</dd>
</dl>
<dl class="docutils" id="repo-config-file">
<dt>REPO_CONFIG_FILE</dt>
<dd>Alias to <a class="reference internal" href="#id1">REPO_CONFIG</a>.</dd>
</dl>
<dl class="docutils" id="repo-config-files">
<dt>REPO_CONFIG_FILES</dt>
<dd>Alias to <a class="reference internal" href="#id1">REPO_CONFIG</a>.</dd>
</dl>
<dl class="docutils" id="simple-rules-file">
<dt>SIMPLE_RULES_FILE</dt>
<dd><p class="first">A list of files and directories with dependency rules.
Directories will be non-recursively scanned for rule files.</p>
<p class="last">This option is <strong>not required, but recommended</strong> since <em>roverlay</em> cannot do
much without dependency resolution.</p>
</dd>
</dl>
<dl class="docutils" id="simple-rules-files">
<dt>SIMPLE_RULES_FILES</dt>
<dd>Alias to <a class="reference internal" href="#simple-rules-file">SIMPLE_RULES_FILE</a>.</dd>
</dl>
</div>
<div class="section" id="logging">
<h2><a class="toc-backref" href="#contents">7.4&nbsp;&nbsp;&nbsp;logging</a></h2>
<dl class="docutils" id="log-date-format">
<dt>LOG_DATE_FORMAT</dt>
<dd><p class="first">The date format (ISO8601) used in log messages.</p>
<p class="last">Defaults to <em>%F %H:%M:%S</em>.</p>
</dd>
</dl>
<dl class="docutils" id="log-enabled">
<dt>LOG_ENABLED</dt>
<dd><p class="first">Globally enable or disable logging. The value has to be a <em>bool</em>.
Setting this option to <em>True</em> allows logging to occur, while <em>False</em>
disables logging entirely.
Log target such as <em>console</em> or <em>file</em> have to be enabled
to actually get any log messages.</p>
<p class="last">Defaults to <em>True</em>.</p>
</dd>
</dl>
<dl class="docutils" id="log-level">
<dt>LOG_LEVEL</dt>
<dd><p class="first">Sets the default log level. Log targets will use this value unless they
have  their own log level.</p>
<p class="last">Defaults to &lt;not set&gt; - all log targets will use their own defaults</p>
</dd>
</dl>
<div class="section" id="console-logging">
<h3><a class="toc-backref" href="#contents">7.4.1&nbsp;&nbsp;&nbsp;console logging</a></h3>
<dl class="docutils" id="log-console">
<dt>LOG_CONSOLE</dt>
<dd><p class="first">Enables/Disables logging to console. The value has to be a <em>bool</em>.</p>
<p class="last">Defaults to <em>True</em>.</p>
</dd>
</dl>
<dl class="docutils" id="log-format-console">
<dt>LOG_FORMAT_CONSOLE</dt>
<dd><p class="first">Sets the format for console log messages.</p>
<p class="last">Defaults to <em>%(levelname)-8s %(name)-14s: %(message)s</em>.</p>
</dd>
</dl>
<dl class="docutils" id="log-level-console">
<dt>LOG_LEVEL_CONSOLE</dt>
<dd><p class="first">Sets the log level for console logging.</p>
<p class="last">Defaults to <em>INFO</em>.</p>
</dd>
</dl>
</div>
<div class="section" id="file-logging">
<h3><a class="toc-backref" href="#contents">7.4.2&nbsp;&nbsp;&nbsp;file logging</a></h3>
<dl class="docutils" id="log-file">
<dt>LOG_FILE</dt>
<dd><p class="first">Sets the log file. File logging will be disabled if this option does not
exist or is commented out even if <a class="reference internal" href="#log-file-enabled">LOG_FILE_ENABLED</a> is set to <em>True</em>.</p>
<p class="last">Defaults to &lt;not set&gt;.</p>
</dd>
</dl>
<dl class="docutils" id="log-file-buffered">
<dt>LOG_FILE_BUFFERED</dt>
<dd><p class="first">Enable/Disable buffering of log entries in memory before they are written
to the log file. Enabling this reduces I/O blocking, especially when using
low log levels. The value must be a <em>bool</em>.</p>
<p class="last">Defaults to enabled.</p>
</dd>
</dl>
<dl class="docutils" id="log-file-buffer-count">
<dt>LOG_FILE_BUFFER_COUNT</dt>
<dd><p class="first">Sets the number of log entries to buffer at most. Can be decreased to
lower memory consumption when using log entry buffering.</p>
<p class="last">Defaults to <em>250</em>.</p>
</dd>
</dl>
<dl class="docutils" id="log-file-enabled">
<dt>LOG_FILE_ENABLED</dt>
<dd><p class="first">Enables/Disable file logging. The value has to be a bool.</p>
<p class="last">Defaults to enabled, in which case file logging is enabled if <a class="reference internal" href="#log-file">LOG_FILE</a>
is set, else disabled.</p>
</dd>
</dl>
<dl class="docutils" id="log-file-format">
<dt>LOG_FILE_FORMAT</dt>
<dd><p class="first">Sets the format used for log messages written to a file.</p>
<p class="last">Defaults to <em>%(asctime)s %(levelname)-8s %(name)-10s: %(message)s</em>.</p>
</dd>
</dl>
<dl class="docutils" id="log-file-level">
<dt>LOG_FILE_LEVEL</dt>
<dd><p class="first">Sets the log level for file logging.</p>
<p class="last">Defaults to <em>WARNING</em>.</p>
</dd>
</dl>
<dl class="docutils" id="log-file-rotate">
<dt>LOG_FILE_ROTATE</dt>
<dd><p class="first">A <em>bool</em> that enables/disables log file rotation. If enabled, the log file
will be rotated on every script run and max. <a class="reference internal" href="#log-file-rotate-count">LOG_FILE_ROTATE_COUNT</a> log
files will be kept.</p>
<p class="last">Defaults to disabled.</p>
</dd>
</dl>
<dl class="docutils" id="log-file-rotate-count">
<dt>LOG_FILE_ROTATE_COUNT</dt>
<dd><p class="first">Sets the number of log files to keep at most.</p>
<p class="last">Defaults to <em>3</em> and has no effect if <a class="reference internal" href="#log-file-rotate">LOG_FILE_ROTATE</a> is disabled.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="options-for-debugging-manual-dependency-rule-creation-and-testing">
<h2><a class="toc-backref" href="#contents">7.5&nbsp;&nbsp;&nbsp;options for debugging, manual dependency rule creation and testing</a></h2>
<dl class="docutils" id="description-dir">
<dt>DESCRIPTION_DIR</dt>
<dd><p class="first">A directory where all description data read from an R package will be
written into. This can be used to analyze/backtrack overlay creation
results.</p>
<p class="last">Defaults to &lt;not set&gt;, which disables writing of description data files.</p>
</dd>
</dl>
<dl class="docutils" id="log-file-unresolvable">
<dt>LOG_FILE_UNRESOLVABLE</dt>
<dd><p class="first">A file where all unresolved dependency strings will be written into
on <em>roverlay</em> exit. Primarily useful for creating new rules.</p>
<p class="last">Defaults to &lt;not set&gt;, which disables this feature.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="field-definition-config">
<span id="id2"></span><h1><a class="toc-backref" href="#contents">8&nbsp;&nbsp;&nbsp;Field Definition Config</a></h1>
<p>The field definition file uses <a class="reference external" href="http://docs.python.org/library/configparser.html">ConfigParser</a> syntax and defines
how an R package's DESCRIPTION file is read.
See the next section, <a class="reference internal" href="#default-field-definition-file">default field definition file</a>,  for an example.</p>
<p>Each information field has its own section which declares a set of options
and flags. Flags are case-insensitive options without a value - they are
enabled by listing them.</p>
<p id="field-options"><span id="field-option"></span>Available field options:</p>
<blockquote>
<dl class="docutils" id="field-option-default-value">
<dt>default_value</dt>
<dd>Sets the default value for a field, which implies that any read
DESCRIPTION file will contain this field, either with the value read
from the file or (as fallback) the default value.
Disables the <a class="reference internal" href="#mandatory-field-flag">'mandatory' field flag</a>.</dd>
</dl>
<dl class="docutils" id="field-option-allowed-value">
<dt>allowed_value</dt>
<dd>Declares that a field has a value whitelist and adds the value to that
list (preserves whitespace).</dd>
</dl>
<dl class="docutils" id="field-option-allowed-values">
<dt>allowed_values</dt>
<dd>Declares that a field has a value whitelist and adds the values to
that list (values are separated by whitespace).</dd>
</dl>
<dl class="docutils" id="field-option-alias">
<span id="field-option-alias-withcase"></span><dt>alias_withcase, alias</dt>
<dd>Declares case-sensitive field name aliases. This can be used to fix
'typos', e.g. <em>Suggest</em> and <em>Suggests</em> both mean <em>Suggests</em>.</dd>
</dl>
<dl class="docutils" id="field-option-alias-nocase">
<dt>alias_nocase</dt>
<dd>Same as <a class="reference internal" href="#field-option-alias">field option: alias</a>, but the listed aliases are
case-insensitive.</dd>
</dl>
<dl class="docutils" id="field-option-flags">
<dt>flags</dt>
<dd>List of <a class="reference internal" href="#field-flags">field flags</a>. Note that any option without a value is treated
as flag.</dd>
</dl>
</blockquote>
<p id="field-flag"><span id="field-flags"></span>Known field flags:</p>
<blockquote>
<dl class="docutils" id="field-flag-joinvalues">
<dt>joinValues</dt>
<dd>Declares that a field's value is one string even if it spans over
multiple lines.
The lines will be joined with a single space character ' '.
The default behavior is to merge lines.</dd>
</dl>
<dl class="docutils" id="field-flag-islist">
<dt>isList</dt>
<dd>Declares that a field's value is a list whose values are separated
by ',' and/or ';'.</dd>
</dl>
<dl class="docutils" id="field-flag-iswhitespacelist">
<dt>isWhitespaceList</dt>
<dd>Declares that a field's value is a list whose values are separated by
whitespace. Has no effect if <cite>field flag: isList</cite> is set.</dd>
</dl>
<dl class="docutils" id="mandatory-field-flag">
<span id="field-flag-mandatory"></span><dt>mandatory</dt>
<dd>Declares that a field is required in <em>all</em> DESCRIPTION files.
This means that R packages without that field are considered as unusable,
i.e. ebuild creation fails early.
This flag is (effectively) useless in conjunction with
<a class="reference internal" href="#field-option-default-value">field option: default_value</a> unless the default value evaluates to
False (e.g. is an empty string).</dd>
</dl>
<dl class="docutils" id="field-flag-ignore">
<dt>ignore</dt>
<dd>Declares that a field is known but entirely ignored. Unknown fields
are ignored, too, the main difference is the emitted log message if
such a field is found.</dd>
</dl>
</blockquote>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">It is not checked whether a flag is known or not.</p>
</div>
<div class="section" id="example-the-default-field-definition-file">
<span id="default-field-definition-file"></span><h2><a class="toc-backref" href="#contents">8.1&nbsp;&nbsp;&nbsp;Example: The default field definition file</a></h2>
<p>This is the default field definition file (without any ignored fields):</p>
<pre class="code ini literal-block">
<span class="k">[Description]</span>
<span class="err">joinValues</span>

<span class="k">[Title]</span>
<span class="err">joinValues</span>

<span class="k">[Suggests]</span>
<span class="na">alias_nocase</span> <span class="o">=</span> <span class="s">Suggests, Suggest, %Suggests, Suggets, Recommends</span>
<span class="err">isList</span>

<span class="k">[Depends]</span>
<span class="na">alias_nocase</span> <span class="o">=</span> <span class="s">Depends, Dependencies, Dependes, %Depends, Depents, Require, Requires</span>
<span class="err">isList</span>

<span class="k">[Imports]</span>
<span class="na">alias_nocase</span> <span class="o">=</span> <span class="s">Imports, Import</span>
<span class="err">isList</span>

<span class="k">[LinkingTo]</span>
<span class="na">alias_nocase</span> <span class="o">=</span> <span class="s">LinkingTo, LinkingdTo, LinkinTo</span>
<span class="err">isList</span>

<span class="k">[SystemRequirements]</span>
<span class="na">alias_nocase</span> <span class="o">=</span> <span class="s">SystemRequirements, SystemRequirement</span>
<span class="err">isList</span>

<span class="k">[OS_Type]</span>
<span class="na">alias_nocase</span>   <span class="o">=</span> <span class="s">OS_TYPE</span>
<span class="na">allowed_values</span> <span class="o">=</span> <span class="s">unix</span>
</pre>
</div>
</div>
<div class="section" id="dependency-resolution-console">
<span id="depres-console"></span><h1><a class="toc-backref" href="#contents">9&nbsp;&nbsp;&nbsp;Dependency Resolution Console</a></h1>
<p>As previously stated, the <em>DepRes Console</em> is only meant for <strong>testing</strong>.
It is an interactive console with the following features:</p>
<ul class="simple">
<li>resolve dependencies</li>
<li>create new dependency rules (<strong>only single line rules</strong>)</li>
<li>create dependency rules for each R package found in a directory</li>
<li>load rules from files</li>
<li>save rules to a file</li>
</ul>
<p>Rules are managed in a set. These so-called <em>rule pools</em> are organized in
a <em>first-in-first-out</em> data structure that allows
to create or remove them easily at runtime.</p>
<p>Running <tt class="docutils literal">roverlay depres_console</tt> will print a welcome message that
lists all available commands and a few usage hints.</p>
<p>For reference, these commands are currently available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">command</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>help,
h</td>
<td>lists all commands</td>
</tr>
<tr><td>help --list,
h --list</td>
<td>lists all help topics for which help is available</td>
</tr>
<tr><td>help <em>&lt;cmd&gt;</em>,
h <em>&lt;cmd&gt;</em></td>
<td>prints a command-specific help message</td>
</tr>
<tr><td>load <em>&lt;file|dir&gt;</em>,
l <em>&lt;file|dir&gt;</em></td>
<td>loads a rule file or a directory with rule files
into a new <em>rule pool</em></td>
</tr>
<tr><td>load_conf,
lc</td>
<td>loads the rule files listed in the config file
into a new <em>rule pool</em></td>
</tr>
<tr><td>addrule <em>&lt;rule&gt;</em>
+ <em>&lt;rule&gt;</em></td>
<td>creates a new rule and adds it to the topmost,
i.e. latest <em>rule pool</em>. This command uses
<a class="reference internal" href="#rule-file-syntax">Rule File Syntax</a>, but multi line rules are
not supported.</td>
</tr>
<tr><td>add_pool,
&lt;&lt;</td>
<td>creates a new <em>rule pool</em></td>
</tr>
<tr><td>unwind,
&gt;&gt;</td>
<td>removes the topmost <em>rule pool</em> and all of its
rules</td>
</tr>
<tr><td>resolve <em>&lt;dep&gt;</em>,
? <em>&lt;dep&gt;</em></td>
<td>tries to resolve the given dependency string and
prints the result</td>
</tr>
<tr><td>print, p</td>
<td>prints the rules of the topmost <em>rule pool</em></td>
</tr>
<tr><td>print all, p all</td>
<td>prints the rules of all <em>rule pools</em></td>
</tr>
<tr><td>write <em>&lt;file&gt;</em>,
w <em>&lt;file&gt;</em></td>
<td>writes the rules of the topmost <em>rule pool</em> into
<em>&lt;file&gt;</em></td>
</tr>
<tr><td>cd <em>&lt;dir&gt;</em></td>
<td>changes the working directory, also creates it if
necessary</td>
</tr>
<tr><td>scandir <em>&lt;dir&gt;</em>,
sd <em>&lt;dir&gt;</em></td>
<td>creates dependency rules for each R package found
in <em>&lt;dir&gt;</em></td>
</tr>
<tr><td>set, unset</td>
<td>prints the status of currently (in)active modes</td>
</tr>
<tr><td>set <em>&lt;mode&gt;</em>,
unset <em>&lt;mode&gt;</em></td>
<td>sets or unsets <em>&lt;mode&gt;</em>. There is only one mode to
control, the <em>shlex mode</em> which controls how
command arguments are parsed</td>
</tr>
<tr><td>mkhelp</td>
<td>verifies that each accessible command has a help
message</td>
</tr>
<tr><td>exit, qq, q</td>
<td>exits the <em>DepRes Console</em></td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Example Session:</dt>
<dd><pre class="code first last literal-block">
== depres console ==
Run 'help' to list all known commands
More specifically, 'help &lt;cmd&gt;' prints a help message for the given
command, and 'help --list' lists all help topics available
Use 'load_conf' or 'lc' to load the configured rule files

commands: load, unwind, set, help, &gt;&gt;, load_conf, &lt;&lt;, cd, mkhelp,
resolve, lc, add_pool, addrule, h, +, l, li, write, p, r, ?, w, print,
sd, unset, scandir
exit-commands: q, qq, exit

cmd % + ~dev-lang/R :: R language
new rules:
~dev-lang/R :: R language
--- ---
command succeeded.

cmd % ? R language
Trying to resolve ('R language',).
Resolved as: ('dev-lang/R',)

cmd % ? R language [ 2.15 ]
Trying to resolve ('R language [ 2.15 ]',).
Resolved as: ('&gt;=dev-lang/R-2.15',)

cmd % ? R
Trying to resolve ('R',).
Channel returned None. At least one dep could not be resolved.

cmd % p
~dev-lang/R :: R language

cmd % &gt;&gt;
Pool removed from resolver.

cmd % p

cmd % ? R language
Trying to resolve ('R language',).
Channel returned None. At least one dep could not be resolved.

cmd % exit
</pre>
</dd>
</dl>
</div>
<div class="section" id="implementation-overview">
<h1><a class="toc-backref" href="#contents">10&nbsp;&nbsp;&nbsp;Implementation Overview</a></h1>
<p>This chapter gives an in-depth overview of how roverlay works.
Code documentation is also available and html pages for it can be created
with <tt class="docutils literal">make pydoc</tt> in the <em>R Overlay src directory</em> or by using pydoc
directly.</p>
<div class="section" id="packageinfo">
<h2><a class="toc-backref" href="#contents">10.1&nbsp;&nbsp;&nbsp;PackageInfo</a></h2>
<p><em>PackageInfo</em> is the data object that contains all information about an
R package and is created by the owning repository.</p>
<p>After initialization it contains data like</p>
<ul class="simple">
<li>the path to the R package file</li>
<li>the origin (repository)</li>
<li>the SRC_URI</li>
<li>the package name, version</li>
</ul>
<p>Not all of these are really existent, some are calculated. <em>SRC_URI</em>,
for example, can often be calculated by combining the origin's &quot;root&quot; src uri
with the package file.</p>
<p>Initialization may fail if the package's name cannot be understood, which is
most likely due to unsupported versioning schemes.</p>
<p>It is then checked whether the newly created <em>PackageInfo p</em> can be part of
the overlay. The overlay may refuse to accept <em>p</em> if an ebuild already exists
for it. Otherwise, <em>p</em> is now part of the overlay and has to pass
<em>ebuild creation</em>.</p>
</div>
<div class="section" id="repository-management">
<h2><a class="toc-backref" href="#contents">10.2&nbsp;&nbsp;&nbsp;Repository Management</a></h2>
<p>Repositories are managed in a list-like object, <em>RepoList</em>. Its task is to
provide R package input for overlay creation and implements the following
functionality:</p>
<ul class="simple">
<li>load repository config from file(s)</li>
<li>directly add a directory as <em>local repository</em></li>
<li><em>sync</em> all repos and <em>nosync</em> all repos (offline mode)</li>
<li>create <em>PackageInfo</em> instances for R packages from all repositories</li>
</ul>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#contents">10.2.1&nbsp;&nbsp;&nbsp;Repositories</a></h3>
<p>The functionality described above is an abstraction layer that calls the
respective function for each repository and collects the result.
So, while the <em>RepoList</em> object knows <em>what</em> to do for all repositories,
a repository object <em>repo</em> extends this by:</p>
<ul>
<li><p class="first">data</p>
<blockquote>
<ul>
<li><p class="first">repository <em>type</em></p>
</li>
<li><p class="first">filesystem directory <em>distdir</em> where <em>repo</em>'s R packages are stored</p>
</li>
<li><p class="first">the <em>root src_uri</em>, which is used to determine the <em>SRC_URI</em> ebuild
variable for all packages from <em>repo</em>:</p>
<p><em>SRC_URI</em> = <em>root src_uri</em> + '/' + &lt;path of R package relative to <em>distdir</em>&gt;</p>
</li>
<li><p class="first">other data like the sync status, repository name</p>
</li>
</ul>
</blockquote>
</li>
<li><p class="first">functionality</p>
<blockquote>
<ul class="simple">
<li>sync/nosync</li>
<li>create <em>PackageInfo</em> instances for all packages from <em>repo</em></li>
<li>status indicators, e.g. if sync was successful</li>
</ul>
</blockquote>
</li>
</ul>
<p>The actual functionality depends on the <em>repository type</em>, i.e. the
implementing class. The most basic implementation that provides all common
data, status indicator functions and <em>PackageInfo</em> creation is called
<em>BasicRepo</em>. It also implements a rather abstract sync function that calls
subclass-specifc <em>_sync()</em>/<em>_nosync()</em> functions if available.
<em>BasicRepos</em> are used to realize <em>local repositories</em>. The other available
repository types, <em>rsync</em>, <em>websync_repo</em> and <em>websync_pkglist</em> derive from
<em>BasicRepo</em>.</p>
<div class="section" id="adding-new-repository-types">
<h4><a class="toc-backref" href="#contents">10.2.1.1&nbsp;&nbsp;&nbsp;Adding new repository types</a></h4>
<p>Adding new repository types is best done by creating a new repo class
that inherits <em>BasicRepo</em>. The table below shows <em>BasicRepo</em>'s subclass
awareness concerning <em>sync()</em> and what may be changed if required.
Most repository types want to define their own sync functionality and
can do so by implementing <em>_dosync()</em>:</p>
<table border="1" class="docutils">
<caption>deriving repository types from BasicRepo</caption>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">function/method</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>_dosync()</td>
<td>sync packages using a remote, has to return True/False</td>
</tr>
<tr><td>_nosync()</td>
<td>sync packages in offline mode (returns True/False)</td>
</tr>
<tr><td>sync (<em>online?</em>)</td>
<td>implemented by <em>BasicRepo</em>, calls _dosync()/_nosync()
if available, else checks whether <em>distdir</em> exists</td>
</tr>
<tr><td>scan_distdir(...)</td>
<td><em>BasicRepo</em>: creates <em>PackageInfo</em> instances for all
R packages in <em>distdir</em>. Derived classes can override
this e.g. if they want to expose only synced packages</td>
</tr>
<tr><td>ready()</td>
<td>tells whether _dosync()/_nosync() was successful,
used by <em>RepoList</em> to decide whether to call
scan_distdir() or not. Properly implemented by
<em>BasicRepo</em> when using its sync() method, else needs
to be overridden.</td>
</tr>
<tr><td>__init__()</td>
<td>has to be implemented if the new class has additional
data. Refer to in-code documentation and examples.</td>
</tr>
</tbody>
</table>
<p>The <em>RsyncRepo</em>, for example, extends <em>BasicRepo</em> by rsync-specific data, e.g.
the uri used for rsync, and has its own <em>__init__()</em> method. It also
implements <em>_dosync()</em>, which calls the <em>rsync</em> executable in a filtered
environment that contains only variables like USER, PATH and RSYNC_PROXY.
The other available repository types have an internal-only implementation:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="28%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">repository type</th>
<th class="head">repository class</th>
<th class="head">_dosync() implementation</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>local</td>
<td>BasicRepo</td>
<td><em>not applicable</em></td>
</tr>
<tr><td>rsync</td>
<td>RsyncRepo</td>
<td><strong>external</strong>, using <em>rsync</em> in
a filtered environment</td>
</tr>
<tr><td>websync_repo
websync_pkglist</td>
<td>WebsyncRepo
WebsyncPackageList</td>
<td>internal, using <em>urllib</em></td>
</tr>
</tbody>
</table>
<p>Repository types also need an entry in the repository config loader in order
to be accessible.</p>
</div>
</div>
</div>
<div class="section" id="overlay">
<h2><a class="toc-backref" href="#contents">10.3&nbsp;&nbsp;&nbsp;Overlay</a></h2>
<p>The <em>overlay</em> is roverlay's central data structure that represents a <em>portage
overlay</em>. It is organized in a tree structure (overlay root, categories,
package directories) and implements all overlay-related functionality:</p>
<ul>
<li><p class="first">Scan the <em>portage overlay</em> for existing ebuilds</p>
</li>
<li><p class="first">Add <em>PackageInfo</em> objects to the overlay. Packages can be declined if
they already exist as ebuild (incremental overlay).
Adding multiple packages at once is <strong>thread-safe</strong>, but overlay writing
is not.</p>
</li>
<li><p class="first">List all known packages (filesystem and runtime/memory)</p>
</li>
<li><p class="first">Write the overlay to its filesystem location</p>
<blockquote>
<ul class="simple">
<li>initialize the overlay (write the <em>profiles/</em> directory,
import eclass files)</li>
<li>Write ebuilds; all <em>PackageInfo</em> instances with an ebuild will be written</li>
<li>Generate and write metadata</li>
<li>Write Manifest files</li>
</ul>
</blockquote>
</li>
<li><p class="first">Features like <a class="reference internal" href="#overlay-keep-nth-latest">OVERLAY_KEEP_NTH_LATEST</a> make use of ebuild deletion,
but unconditional ebuild deletion is only available on the package directory
level</p>
</li>
</ul>
<div class="section" id="metadata-creation">
<h3><a class="toc-backref" href="#contents">10.3.1&nbsp;&nbsp;&nbsp;Metadata Creation</a></h3>
<p><em>metadata.xml</em> files are created with a tree structure that contains <em>metadata
nodes</em>, e.g. '&lt;pkgmetadata&gt;...&lt;/pkgmetadata&gt;' and '&lt;use&gt;...&lt;/use&gt;' are <em>nodes</em>.
The current implementation writes the R package's full description
('Title' and 'Description') into the metadata file.
Metadata creation uses the latest package, i.e. highest version,
for which an ebuild has been created.</p>
</div>
<div class="section" id="manifest-creation">
<h3><a class="toc-backref" href="#contents">10.3.2&nbsp;&nbsp;&nbsp;Manifest Creation</a></h3>
<p>Manifest files are created by calling the <em>ebuild</em> executable for each
package directory in a filtered environment where FETCHCOMMAND and
RESUMECOMMAND are set to no-operation. The directories that contain the R
package files are passed in the PORTAGE_RO_DISTDIRS variable and DISTDIR
is set to <a class="reference internal" href="#distfiles-root">DISTFILES_ROOT</a>/__tmp__.</p>
</div>
</div>
<div class="section" id="ebuild-creation">
<h2><a class="toc-backref" href="#contents">10.4&nbsp;&nbsp;&nbsp;Ebuild Creation</a></h2>
<p>Ebuild creation is the process centered around one <em>PackageInfo</em> instance <em>p</em>
that tries to create an ebuild for it.</p>
<p>It does the following steps:</p>
<ol class="arabic simple">
<li>Read the DESCRIPTION file of <em>p</em> R package tarball and stores the
data in an associative array ('DESCRIPTION field' -&gt; 'data')</li>
<li>Call <a class="reference internal" href="#dependency-resolution">dependency resolution</a></li>
<li>If dependency resolution was successful, dependency ebuild variables are
created (<em>DEPEND</em>, <em>RDEPEND</em> and <em>R_SUGGESTS</em>, also <em>IUSE</em>, <em>MISSINGDEPS</em>).
Otherwise <strong>ebuild creation stops</strong> and <em>p</em> is marked as
<em>ebuild uncreatable</em>. The overlay creation may decide to remove <em>p</em> in
order to save memory etc.</li>
<li>The <em>DESCRIPTION</em> and <em>SRC_URI</em> variables are created</li>
<li><strong>done</strong> - Generate the ebuild as text, add it to <em>p</em> and mark <em>p</em>
as <em>ebuild successfully created</em></li>
</ol>
<div class="section" id="ebuild-variables">
<h3><a class="toc-backref" href="#contents">10.4.1&nbsp;&nbsp;&nbsp;Ebuild Variables</a></h3>
<p>Each ebuild variable is an object whose class is derived from the <em>EbuildVar</em>
class. An <em>EbuildVar</em> defines its position in the ebuild and  how its text
output should look like. Ebuild text is created by adding ebuild variables
to an <em>Ebuilder</em> that automatically sorts them and creates the ebuild.</p>
</div>
</div>
<div class="section" id="overlay-creation">
<h2><a class="toc-backref" href="#contents">10.5&nbsp;&nbsp;&nbsp;Overlay Creation</a></h2>
<p>Overlay creation is the process of creating an overlay for many R packages
and <em>roverlay</em>'s main task. More specifically, <em>OverlayCreation</em> is an
<em>R packages -&gt; Overlay (-&gt; overlay in filesystem)</em> interface.
It accepts <em>PackageInfo</em> objects as input, tries to reserve a slot in the
overlay for them, and, if successful, adds them to the work queue.</p>
<p>The work queue is processed by <em>OverlayWorkers</em> that run ebuild creation
for a <em>PackageInfo</em> object and inform the <em>OverlayCreation</em> about the result
afterwards. Overlay creation keeps going if an ebuild cannot be created,
instead the event is logged. Running more than one <em>OverlayWorker</em> in parallel
is possible.</p>
</div>
<div class="section" id="dependency-resolution">
<h2><a class="toc-backref" href="#contents">10.6&nbsp;&nbsp;&nbsp;Dependency Resolution</a></h2>
<p>Each ebuild creation process has access to the <em>dependency resolver</em> that
accepts <em>dependency strings</em>, tries to resolve them and returns the result,
either &quot;unresolvable&quot; or the resolving <em>dependency</em> as
<em>Dynamic DEPEND</em>/<em>DEPEND Atom</em>.</p>
<p>The ebuild creation uses <em>channels</em> for communication with the <em>dependency
resolver</em>, so-called <em>EbuildJobChannels</em> that handle the 'high-level'
string-to-string dependency resolution for a set of <em>dependency strings</em>.
Typically, one <em>channel</em> is used per ebuild variable (DEPEND, RDEPEND and
R_SUGGESTS).</p>
<p>From the ebuild creation perspective, dependency resolution works like this:</p>
<ol class="arabic simple">
<li>Collect the <em>dependency strings</em> from the DESCRIPTION data and add them
to the communication <em>channels</em> (up to 3 will be used)</li>
<li>Wait until all channels are <em>done</em></li>
<li><strong>Stop ebuild creation</strong> if a channel reports that it could not resolve
all <em>required dependencies</em>. No ebuild can be created in that case.</li>
<li><strong>Successfully done</strong> - transfer the channel results to ebuild variables</li>
</ol>
<p>Details about dependency resolution like how <em>channels</em> work can be found
in the following subsections.</p>
<div class="section" id="dependency-types">
<h3><a class="toc-backref" href="#contents">10.6.1&nbsp;&nbsp;&nbsp;Dependency types</a></h3>
<p>Every <em>dependency string</em> has a <em>dependency type</em> that declares how a
dependency should be resolved. It has one or more of these properties:</p>
<dl class="docutils">
<dt>Mandatory</dt>
<dd>Ebuild creation fails if the <em>dependency string</em> in question cannot
be resolved.</dd>
<dt>Optional</dt>
<dd>The opposite of <em>Mandatory</em>, ebuild creation keeps going even if the
<em>dependency string</em> is unresolvable.</dd>
<dt>Package Dependency</dt>
<dd>This declares that the <em>dependency string</em> could be another R package.</dd>
<dt>System Dependency</dt>
<dd>This declares that the <em>dependency string</em> could be a system dependency,
e.g. a scientific library or a video encoder.</dd>
<dt>Try other dependency types</dt>
<dd>This declares that the <em>dependency string</em> can be resolved by ignoring its
dependency type partially. This property allows to resolve package
dependencies as system dependencies and vice versa. Throughout this
document, such property is indicated by <em>TRY_OTHER</em> and
<em>&lt;preferred dependency type&gt; first</em>, e.g. <em>package first</em>.</dd>
</dl>
<p><em>Mandatory</em> and <em>Option</em> are mutually exclusive.</p>
<p>The <em>dependency type</em> of a <em>dependency string</em> is determined by its origin,
i.e. info field in the package's DESCRIPTION file.
The <em>Suggests</em> field, for example, gets the
<em>&quot;package dependency only and optional&quot;</em> type, whereas the <em>SystemRequirements</em>
gets <em>&quot;system dependency, but try others, and mandatory&quot;</em>.</p>
<div class="section" id="description-file-dependency-fields">
<h4><a class="toc-backref" href="#contents">10.6.1.1&nbsp;&nbsp;&nbsp;DESCRIPTION file dependency fields</a></h4>
<p>The DESCRIPTION file of an R package contains several fields that list
dependencies on R packages or other software like scientific libraries.
This section describes which <em>dependency fields</em> are used and how.</p>
<table border="1" class="docutils">
<caption>R package dependency fields</caption>
<colgroup>
<col width="28%" />
<col width="31%" />
<col width="25%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">dependency field</th>
<th class="head">ebuild variable</th>
<th class="head">dependency type</th>
<th class="head">required</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Depends</td>
<td rowspan="2">DEPEND</td>
<td rowspan="2">package first</td>
<td rowspan="4"><em>yes</em></td>
</tr>
<tr><td>Imports</td>
</tr>
<tr><td>LinkingTo</td>
<td rowspan="2">RDEPEND</td>
<td>package first</td>
</tr>
<tr><td>SystemRequirements</td>
<td>system first</td>
</tr>
<tr><td rowspan="2">Suggests</td>
<td>R_SUGGESTS</td>
<td>package <strong>only</strong></td>
<td><strong>no</strong></td>
</tr>
<tr><td>_UNRESOLVED_PACKAGES</td>
<td><em>unresolvable</em></td>
<td><em>n/a</em></td>
</tr>
</tbody>
</table>
<p>A non-empty <em>R_SUGGESTS</em> ebuild variable will enable the <em>R_suggests</em> USE
flag. <em>R_SUGGESTS</em> is a runtime dependency (a <em>Dynamic DEPEND</em> in <em>RDEPEND</em>).</p>
<p>Ebuild creation keeps going if an optional dependency cannot be resolved.
This is not desirable for most <em>dependency fields</em>, but extremely
useful for R package suggestions that often link to other repositories or
private homepages.
Such unresolvable dependencies go into the <em>_UNRESOLVED_PACKAGES</em> ebuild
variable.
Whether and how this variable is used is up to the eclass file(s).
The default <em>R-packages eclass</em> reports unresolvable,
but optional dependencies during the <em>pkg_postinst()</em> ebuild phase.</p>
</div>
</div>
<div class="section" id="dependency-environments">
<h3><a class="toc-backref" href="#contents">10.6.2&nbsp;&nbsp;&nbsp;Dependency Environments</a></h3>
<p>A <em>dependency environment</em> is an object that reflects the whole dependency
resolution process of a single <em>dependency string</em>. It usually contains
the <em>dependency string</em>, its <em>dependency type</em>, information about its
resolution state (<em>resolved</em>, <em>unresolvable</em>, <em>to be processed</em>) and the
resolving resolving <em>dependency</em>, if any.</p>
<p>It is initialized by the communication <em>channel</em> and processed by the
<em>dependency resolver</em>.</p>
</div>
<div class="section" id="ebuildjob-channel">
<h3><a class="toc-backref" href="#contents">10.6.3&nbsp;&nbsp;&nbsp;EbuildJob Channel</a></h3>
<p>The <em>EbuildJob Channel</em> is used by the ebuild creation to communicate with
the <em>dependency resolver</em>. It is initialized by an ebuild creation process and
realizes a greedy <em>string to string</em> dependency resolution.</p>
<p>Its mode of operation is</p>
<ol class="arabic">
<li><p class="first">Accept <em>dependency strings</em>, create <em>dependency environments</em> for them
and add them to the registered <em>dependency resolver</em>.
The <em>dependency resolver</em> may already be resolving the added dependencies.</p>
<p>Leave this state if the ebuild creation signalizes that all <em>dependency
strings</em> have been added.</p>
</li>
<li><p class="first">Tell the <em>dependency resolver</em> that this channel is waiting for results.</p>
<p>The channel using a <em>blocking queue</em> for waiting. It expects that the
<em>dependency resolver</em> sends processed <em>dependency environments</em> though this
channel, whether successful or not.</p>
</li>
<li><p class="first">Process each received <em>dependency environment</em> until all dependencies have
been resolved or waiting does not make sense anymore, i.e. at least one
<em>required</em> dependency could not be resolved.</p>
<ul class="simple">
<li>add successful resolved dependencies to the &quot;resolved&quot; list</li>
<li>add unresolved, but optional dependencies to the &quot;unresolvable&quot; list</li>
<li>any other unresolved dependency is interpreted as &quot;channel cannot satisfy
the request&quot;, the <strong>channel stops waiting</strong> for remaining results.</li>
</ul>
</li>
<li><p class="first">The <em>channel</em> returns the result to the ebuild creation:</p>
<ul class="simple">
<li>a 2-tuple of resolved and unresolvable dependencies or</li>
<li>&quot;nothing&quot; if the request is not satisfiable, i.e. one or more required
dependencies are unresolvable.</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="dependency-rule-pools">
<h3><a class="toc-backref" href="#contents">10.6.4&nbsp;&nbsp;&nbsp;Dependency Rule Pools</a></h3>
<p>The <em>dependency resolver</em> does not know <em>how</em> to resolve a <em>dependency string</em>.
Instead, it searches through a list of <em>dependency rule pools</em> that may be
able to do this.</p>
<p>A <em>dependency rule pool</em> combines a list of <em>dependency rules</em> with a
<em>dependency type</em> and is able to determine whether it accepts the type
of a <em>dependency string</em> or not.</p>
<p><em>Dependency rules</em> are objects with a &quot;matches&quot; function that returns the
<em>resolving dependency</em> if it matches the given <em>dependency string</em>, else
it returns &quot;cannot resolve&quot;. Note the difference between
&quot;a rule cannot resolve a dep string&quot; and &quot;dep string is unresolvable&quot;,
which means that no rule can resolve a particular <em>dependency string</em>.</p>
<p>See <a class="reference internal" href="#dependency-rules">Dependency Rules</a> for the concrete rules available.</p>
<p>Rule pools are normally created by reading rule files, but some rule pools
consist of rules that exist in memory only.
These are called <strong>Dynamic Rule Pools</strong> and use runtime data like &quot;all known
R packages&quot; to create rules.</p>
<p id="dynamic-selfdep-rule-pool"><em>roverlay</em> uses one dynamic rule pool, the <strong>Dynamic Selfdep Rule Pool</strong>.
This pool contains rules for all known R packages and is able to resolve
R package dependencies.
By convention, it will never resolve any system dependencies.</p>
</div>
<div class="section" id="dependency-resolver-modules">
<h3><a class="toc-backref" href="#contents">10.6.5&nbsp;&nbsp;&nbsp;Dependency Resolver Modules</a></h3>
<p>The dependency resolver can be extended by modules. Two base types are
available, <em>channels</em> and <em>listeners</em>.</p>
<dl class="docutils">
<dt>Listener modules</dt>
<dd><p class="first">Listener modules are used to react on certain dependency resolution
<em>events</em>, e.g. if a <em>dependency environment</em> is unresolvable.
They usually have access to the <em>event</em> and the <em>dependency environment</em>.
However, they cannot begin communication with the <em>dependency resolver</em>.</p>
<p class="last">In the current <em>roverlay</em> implementation, a listener module is used to
report all unresolvable dependencies to a separate file.</p>
</dd>
<dt>Channel modules</dt>
<dd><p class="first">Channel modules interact with the resolver, e.g. queue dependencies for
resolution, wait for results, and send them to the other end.</p>
<p class="last">The previously described <a class="reference internal" href="#ebuildjob-channel">EbuildJob Channel</a> is such a channel.</p>
</dd>
</dl>
</div>
<div class="section" id="dependency-resolver">
<h3><a class="toc-backref" href="#contents">10.6.6&nbsp;&nbsp;&nbsp;Dependency Resolver</a></h3>
<p>The dependency resolver puts all parts of dependency resolution together,
<em>rule pools</em>, <em>listeners</em> and <em>channels</em>. Its main task is a loop that
processes all queued <em>dependency environments</em> and sends the result back to
their origin (an <em>EbuildJob channel</em>).</p>
<p>Besides that, it also offers functionality to register new channels, add
listeners, load rule pools from one or more files etc..
A dependency resolver has to be explicitly closed in which case it will stop
working and notify all listeners about that.</p>
<p>Its mode of operation of operation is best described in pseudo-code:</p>
<pre class="code text literal-block">
while &lt;dependencies queued for resolution&gt;

   depenv   &lt;= get the next dependency environment
   resolved &lt;= False

   # try to resolve depenv

   if &lt;depenv's type contains PACKAGE&gt; and
   &lt;the dynamic selfdep rule pool resolves depenv&gt;

      resolved &lt;= True

   else
      if &lt;a rule pool accepts depenv's type and resolves depenv&gt;
         resolved &lt;= True

      else if &lt;depenv's type contains TRY_OTHER&gt;

         if &lt;a rule pool supports TRY_OTHER and does not accept depenv's type and resolves depenv&gt;

            resolved &lt;= True
      end if
   end if


   # send the result to depenv's channel

   if resolved
      mark depenv as resolved, add the resolving dependency to it

   else
      mark depenv as unresolvable

   end if

   send depenv to its channel

end while
</pre>
<p>The dependency resolver can be <strong>run as thread</strong>, in which case the while loop
becomes &quot;loop until resolver closes&quot;.</p>
</div>
</div>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2012-08-20.

</div>
</body>
</html>
